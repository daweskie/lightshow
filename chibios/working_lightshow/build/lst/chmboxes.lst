   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 3
   4              		.fpu fpv4-sp-d16
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 6
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.thumb
  15              		.file	"chmboxes.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.rodata
  20              		.align	2
  21              	.LC0:
  22 0000 2263684D 		.ascii	"\"chMBInit\"()\000"
  22      42496E69 
  22      74222829 
  22      00
  23              		.section	.text.chMBInit,"ax",%progbits
  24              		.align	2
  25              		.p2align 4,,15
  26              		.global	chMBInit
  27              		.thumb
  28              		.thumb_func
  30              	chMBInit:
  31              	.LFB7:
  32              		.file 1 "/usr/src/chibiostest/os/kernel/src/chmboxes.c"
   1:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /*
   2:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     ChibiOS/RT - Copyright (C) 2006,2007,2008,2009,2010,
   3:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****                  2011,2012 Giovanni Di Sirio.
   4:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
   5:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     This file is part of ChibiOS/RT.
   6:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
   7:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     ChibiOS/RT is free software; you can redistribute it and/or modify
   8:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     it under the terms of the GNU General Public License as published by
   9:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     the Free Software Foundation; either version 3 of the License, or
  10:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     (at your option) any later version.
  11:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  12:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     ChibiOS/RT is distributed in the hope that it will be useful,
  13:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  14:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  15:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     GNU General Public License for more details.
  16:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  17:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     You should have received a copy of the GNU General Public License
  18:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  19:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** */
  20:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  21:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
  22:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @file    chmboxes.c
  23:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Mailboxes code.
  24:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
  25:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @addtogroup mailboxes
  26:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details Asynchronous messages.
  27:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          <h2>Operation mode</h2>
  28:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          A mailbox is an asynchronous communication mechanism.<br>
  29:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          Operations defined for mailboxes:
  30:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          - <b>Post</b>: Posts a message on the mailbox in FIFO order.
  31:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          - <b>Post Ahead</b>: Posts a message on the mailbox with urgent
  32:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *            priority.
  33:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          - <b>Fetch</b>: A message is fetched from the mailbox and removed
  34:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *            from the queue.
  35:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          - <b>Reset</b>: The mailbox is emptied and all the stored messages
  36:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *            are lost.
  37:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          .
  38:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          A message is a variable of type msg_t that is guaranteed to have
  39:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          the same size of and be compatible with (data) pointers (anyway an
  40:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          explicit cast is needed).
  41:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          If larger messages need to be exchanged then a pointer to a
  42:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          structure can be posted in the mailbox but the posting side has
  43:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          no predefined way to know when the message has been processed. A
  44:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          possible approach is to allocate memory (from a memory pool for
  45:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          example) from the posting side and free it on the fetching side.
  46:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          Another approach is to set a "done" flag into the structure pointed
  47:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          by the message.
  48:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @pre     In order to use the mailboxes APIs the @p CH_USE_MAILBOXES option
  49:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          must be enabled in @p chconf.h.
  50:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @{
  51:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
  52:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  53:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** #include "ch.h"
  54:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  55:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** #if CH_USE_MAILBOXES || defined(__DOXYGEN__)
  56:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
  57:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Initializes a Mailbox object.
  58:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
  59:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[out] mbp      the pointer to the Mailbox structure to be initialized
  60:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] buf       pointer to the messages buffer as an array of @p msg_t
  61:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] n         number of elements in the buffer array
  62:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
  63:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @init
  64:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
  65:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** void chMBInit(Mailbox *mbp, msg_t *buf, cnt_t n) {
  33              		.loc 1 65 0
  34              		.cfi_startproc
  35              		@ args = 0, pretend = 0, frame = 16
  36              		@ frame_needed = 0, uses_anonymous_args = 0
  37 0000 00B5     		push	{lr}
  38              		.cfi_def_cfa_offset 4
  39              		.cfi_offset 14, -4
  40 0002 85B0     		sub	sp, sp, #20
  41              		.cfi_def_cfa_offset 24
  42 0004 0390     		str	r0, [sp, #12]
  43 0006 0291     		str	r1, [sp, #8]
  44 0008 0192     		str	r2, [sp, #4]
  66:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  67:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck((mbp != NULL) && (buf != NULL) && (n > 0), "chMBInit");
  45              		.loc 1 67 0
  46 000a 039B     		ldr	r3, [sp, #12]
  47 000c 002B     		cmp	r3, #0
  48 000e 05D0     		beq	.L2
  49              		.loc 1 67 0 is_stmt 0 discriminator 2
  50 0010 029B     		ldr	r3, [sp, #8]
  51 0012 002B     		cmp	r3, #0
  52 0014 02D0     		beq	.L2
  53              		.loc 1 67 0 discriminator 1
  54 0016 019B     		ldr	r3, [sp, #4]
  55 0018 002B     		cmp	r3, #0
  56 001a 02DC     		bgt	.L3
  57              	.L2:
  58 001c 1148     		ldr	r0, .L4
  59 001e FFF7FEFF 		bl	chDbgPanic
  60              	.L3:
  68:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  69:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   mbp->mb_buffer = mbp->mb_wrptr = mbp->mb_rdptr = buf;
  61              		.loc 1 69 0 is_stmt 1
  62 0022 039B     		ldr	r3, [sp, #12]
  63 0024 029A     		ldr	r2, [sp, #8]
  64 0026 DA60     		str	r2, [r3, #12]
  65 0028 039B     		ldr	r3, [sp, #12]
  66 002a DA68     		ldr	r2, [r3, #12]
  67 002c 039B     		ldr	r3, [sp, #12]
  68 002e 9A60     		str	r2, [r3, #8]
  69 0030 039B     		ldr	r3, [sp, #12]
  70 0032 9A68     		ldr	r2, [r3, #8]
  71 0034 039B     		ldr	r3, [sp, #12]
  72 0036 1A60     		str	r2, [r3]
  70:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   mbp->mb_top = &buf[n];
  73              		.loc 1 70 0
  74 0038 019B     		ldr	r3, [sp, #4]
  75 003a 9B00     		lsls	r3, r3, #2
  76 003c 029A     		ldr	r2, [sp, #8]
  77 003e 1A44     		add	r2, r2, r3
  78 0040 039B     		ldr	r3, [sp, #12]
  79 0042 5A60     		str	r2, [r3, #4]
  71:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemInit(&mbp->mb_emptysem, n);
  80              		.loc 1 71 0
  81 0044 039B     		ldr	r3, [sp, #12]
  82 0046 1C33     		adds	r3, r3, #28
  83 0048 1846     		mov	r0, r3
  84 004a 0199     		ldr	r1, [sp, #4]
  85 004c FFF7FEFF 		bl	chSemInit
  72:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemInit(&mbp->mb_fullsem, 0);
  86              		.loc 1 72 0
  87 0050 039B     		ldr	r3, [sp, #12]
  88 0052 1033     		adds	r3, r3, #16
  89 0054 1846     		mov	r0, r3
  90 0056 0021     		movs	r1, #0
  91 0058 FFF7FEFF 		bl	chSemInit
  73:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
  92              		.loc 1 73 0
  93 005c 05B0     		add	sp, sp, #20
  94              		@ sp needed
  95 005e 5DF804FB 		ldr	pc, [sp], #4
  96              	.L5:
  97 0062 00BF     		.align	2
  98              	.L4:
  99 0064 00000000 		.word	.LC0
 100              		.cfi_endproc
 101              	.LFE7:
 103 0068 AFF30080 		.section	.rodata
 103      AFF30080 
 104 000d 000000   		.align	2
 105              	.LC1:
 106 0010 2263684D 		.ascii	"\"chMBReset\"()\000"
 106      42526573 
 106      65742228 
 106      2900
 107              		.section	.text.chMBReset,"ax",%progbits
 108              		.align	2
 109              		.p2align 4,,15
 110              		.global	chMBReset
 111              		.thumb
 112              		.thumb_func
 114              	chMBReset:
 115              	.LFB8:
  74:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  75:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
  76:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Resets a Mailbox object.
  77:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details All the waiting threads are resumed with status @p RDY_RESET and
  78:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          the queued messages are lost.
  79:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
  80:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
  81:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
  82:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @api
  83:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
  84:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** void chMBReset(Mailbox *mbp) {
 116              		.loc 1 84 0
 117              		.cfi_startproc
 118              		@ args = 0, pretend = 0, frame = 8
 119              		@ frame_needed = 0, uses_anonymous_args = 0
 120 0000 00B5     		push	{lr}
 121              		.cfi_def_cfa_offset 4
 122              		.cfi_offset 14, -4
 123 0002 83B0     		sub	sp, sp, #12
 124              		.cfi_def_cfa_offset 16
 125 0004 0190     		str	r0, [sp, #4]
  85:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  86:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck(mbp != NULL, "chMBReset");
 126              		.loc 1 86 0
 127 0006 019B     		ldr	r3, [sp, #4]
 128 0008 002B     		cmp	r3, #0
 129 000a 02D1     		bne	.L7
 130              		.loc 1 86 0 is_stmt 0 discriminator 1
 131 000c 1648     		ldr	r0, .L8
 132 000e FFF7FEFF 		bl	chDbgPanic
 133              	.L7:
 134              	.LBB2:
  87:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  88:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysLock();
 135              		.loc 1 88 0 is_stmt 1
 136 0012 2023     		movs	r3, #32
 137              	@ 88 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 138 0014 83F31188 		msr     BASEPRI, r3
 139              	@ 0 "" 2
 140              		.thumb
 141              	.LBE2:
 142 0018 FFF7FEFF 		bl	dbg_check_lock
  89:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   mbp->mb_wrptr = mbp->mb_rdptr = mbp->mb_buffer;
 143              		.loc 1 89 0
 144 001c 019B     		ldr	r3, [sp, #4]
 145 001e 1A68     		ldr	r2, [r3]
 146 0020 019B     		ldr	r3, [sp, #4]
 147 0022 DA60     		str	r2, [r3, #12]
 148 0024 019B     		ldr	r3, [sp, #4]
 149 0026 DA68     		ldr	r2, [r3, #12]
 150 0028 019B     		ldr	r3, [sp, #4]
 151 002a 9A60     		str	r2, [r3, #8]
  90:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemResetI(&mbp->mb_emptysem, mbp->mb_top - mbp->mb_buffer);
 152              		.loc 1 90 0
 153 002c 019B     		ldr	r3, [sp, #4]
 154 002e 03F11C02 		add	r2, r3, #28
 155 0032 019B     		ldr	r3, [sp, #4]
 156 0034 5B68     		ldr	r3, [r3, #4]
 157 0036 1946     		mov	r1, r3
 158 0038 019B     		ldr	r3, [sp, #4]
 159 003a 1B68     		ldr	r3, [r3]
 160 003c CB1A     		subs	r3, r1, r3
 161 003e 9B10     		asrs	r3, r3, #2
 162 0040 1046     		mov	r0, r2
 163 0042 1946     		mov	r1, r3
 164 0044 FFF7FEFF 		bl	chSemResetI
  91:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemResetI(&mbp->mb_fullsem, 0);
 165              		.loc 1 91 0
 166 0048 019B     		ldr	r3, [sp, #4]
 167 004a 1033     		adds	r3, r3, #16
 168 004c 1846     		mov	r0, r3
 169 004e 0021     		movs	r1, #0
 170 0050 FFF7FEFF 		bl	chSemResetI
  92:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSchRescheduleS();
 171              		.loc 1 92 0
 172 0054 FFF7FEFF 		bl	chSchRescheduleS
  93:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysUnlock();
 173              		.loc 1 93 0
 174 0058 FFF7FEFF 		bl	dbg_check_unlock
 175              	.LBB3:
 176 005c 0023     		movs	r3, #0
 177              	@ 93 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 178 005e 83F31188 		msr     BASEPRI, r3
 179              	@ 0 "" 2
 180              		.thumb
 181              	.LBE3:
  94:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 182              		.loc 1 94 0
 183 0062 03B0     		add	sp, sp, #12
 184              		@ sp needed
 185 0064 5DF804FB 		ldr	pc, [sp], #4
 186              	.L9:
 187              		.align	2
 188              	.L8:
 189 0068 10000000 		.word	.LC1
 190              		.cfi_endproc
 191              	.LFE8:
 193 006c AFF30080 		.section	.text.chMBPost,"ax",%progbits
 194              		.align	2
 195              		.p2align 4,,15
 196              		.global	chMBPost
 197              		.thumb
 198              		.thumb_func
 200              	chMBPost:
 201              	.LFB9:
  95:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
  96:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
  97:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Posts a message into a mailbox.
  98:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details The invoking thread waits until a empty slot in the mailbox becomes
  99:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          available or the specified time runs out.
 100:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 101:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 102:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] msg       the message to be posted on the mailbox
 103:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] time      the number of ticks before the operation timeouts,
 104:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      the following special values are allowed:
 105:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 106:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_INFINITE no timeout.
 107:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      .
 108:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 109:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly posted.
 110:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_RESET    if the mailbox has been reset while waiting.
 111:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the operation has timed out.
 112:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 113:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @api
 114:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 115:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBPost(Mailbox *mbp, msg_t msg, systime_t time) {
 202              		.loc 1 115 0
 203              		.cfi_startproc
 204              		@ args = 0, pretend = 0, frame = 24
 205              		@ frame_needed = 0, uses_anonymous_args = 0
 206 0000 00B5     		push	{lr}
 207              		.cfi_def_cfa_offset 4
 208              		.cfi_offset 14, -4
 209 0002 87B0     		sub	sp, sp, #28
 210              		.cfi_def_cfa_offset 32
 211 0004 0390     		str	r0, [sp, #12]
 212 0006 0291     		str	r1, [sp, #8]
 213 0008 0192     		str	r2, [sp, #4]
 214              	.LBB4:
 116:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   msg_t rdymsg;
 117:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 118:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysLock();
 215              		.loc 1 118 0
 216 000a 2023     		movs	r3, #32
 217              	@ 118 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 218 000c 83F31188 		msr     BASEPRI, r3
 219              	@ 0 "" 2
 220              		.thumb
 221              	.LBE4:
 222 0010 FFF7FEFF 		bl	dbg_check_lock
 119:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   rdymsg = chMBPostS(mbp, msg, time);
 223              		.loc 1 119 0
 224 0014 0398     		ldr	r0, [sp, #12]
 225 0016 0299     		ldr	r1, [sp, #8]
 226 0018 019A     		ldr	r2, [sp, #4]
 227 001a FFF7FEFF 		bl	chMBPostS
 228 001e 0590     		str	r0, [sp, #20]
 120:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysUnlock();
 229              		.loc 1 120 0
 230 0020 FFF7FEFF 		bl	dbg_check_unlock
 231              	.LBB5:
 232 0024 0023     		movs	r3, #0
 233              	@ 120 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 234 0026 83F31188 		msr     BASEPRI, r3
 235              	@ 0 "" 2
 236              		.thumb
 237              	.LBE5:
 121:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return rdymsg;
 238              		.loc 1 121 0
 239 002a 059B     		ldr	r3, [sp, #20]
 122:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 240              		.loc 1 122 0
 241 002c 1846     		mov	r0, r3
 242 002e 07B0     		add	sp, sp, #28
 243              		@ sp needed
 244 0030 5DF804FB 		ldr	pc, [sp], #4
 245              		.cfi_endproc
 246              	.LFE9:
 248 0034 AFF30080 		.section	.rodata
 248      AFF30080 
 248      AFF30080 
 249 001e 0000     		.align	2
 250              	.LC2:
 251 0020 2263684D 		.ascii	"\"chMBPostS\"()\000"
 251      42506F73 
 251      74532228 
 251      2900
 252              		.section	.text.chMBPostS,"ax",%progbits
 253              		.align	2
 254              		.p2align 4,,15
 255              		.global	chMBPostS
 256              		.thumb
 257              		.thumb_func
 259              	chMBPostS:
 260              	.LFB10:
 123:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 124:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 125:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Posts a message into a mailbox.
 126:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details The invoking thread waits until a empty slot in the mailbox becomes
 127:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          available or the specified time runs out.
 128:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 129:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 130:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] msg       the message to be posted on the mailbox
 131:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] time      the number of ticks before the operation timeouts,
 132:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      the following special values are allowed:
 133:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 134:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_INFINITE no timeout.
 135:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      .
 136:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 137:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly posted.
 138:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_RESET    if the mailbox has been reset while waiting.
 139:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the operation has timed out.
 140:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 141:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @sclass
 142:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 143:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBPostS(Mailbox *mbp, msg_t msg, systime_t time) {
 261              		.loc 1 143 0
 262              		.cfi_startproc
 263              		@ args = 0, pretend = 0, frame = 24
 264              		@ frame_needed = 0, uses_anonymous_args = 0
 265 0000 00B5     		push	{lr}
 266              		.cfi_def_cfa_offset 4
 267              		.cfi_offset 14, -4
 268 0002 87B0     		sub	sp, sp, #28
 269              		.cfi_def_cfa_offset 32
 270 0004 0390     		str	r0, [sp, #12]
 271 0006 0291     		str	r1, [sp, #8]
 272 0008 0192     		str	r2, [sp, #4]
 144:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   msg_t rdymsg;
 145:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 146:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheckClassS();
 273              		.loc 1 146 0
 274 000a FFF7FEFF 		bl	chDbgCheckClassS
 147:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck(mbp != NULL, "chMBPostS");
 275              		.loc 1 147 0
 276 000e 039B     		ldr	r3, [sp, #12]
 277 0010 002B     		cmp	r3, #0
 278 0012 02D1     		bne	.L13
 279              		.loc 1 147 0 is_stmt 0 discriminator 1
 280 0014 1448     		ldr	r0, .L17
 281 0016 FFF7FEFF 		bl	chDbgPanic
 282              	.L13:
 148:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 149:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   rdymsg = chSemWaitTimeoutS(&mbp->mb_emptysem, time);
 283              		.loc 1 149 0 is_stmt 1
 284 001a 039B     		ldr	r3, [sp, #12]
 285 001c 1C33     		adds	r3, r3, #28
 286 001e 1846     		mov	r0, r3
 287 0020 0199     		ldr	r1, [sp, #4]
 288 0022 FFF7FEFF 		bl	chSemWaitTimeoutS
 289 0026 0590     		str	r0, [sp, #20]
 150:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (rdymsg == RDY_OK) {
 290              		.loc 1 150 0
 291 0028 059B     		ldr	r3, [sp, #20]
 292 002a 002B     		cmp	r3, #0
 293 002c 17D1     		bne	.L14
 151:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     *mbp->mb_wrptr++ = msg;
 294              		.loc 1 151 0
 295 002e 039B     		ldr	r3, [sp, #12]
 296 0030 9B68     		ldr	r3, [r3, #8]
 297 0032 191D     		adds	r1, r3, #4
 298 0034 039A     		ldr	r2, [sp, #12]
 299 0036 9160     		str	r1, [r2, #8]
 300 0038 029A     		ldr	r2, [sp, #8]
 301 003a 1A60     		str	r2, [r3]
 152:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     if (mbp->mb_wrptr >= mbp->mb_top)
 302              		.loc 1 152 0
 303 003c 039B     		ldr	r3, [sp, #12]
 304 003e 9A68     		ldr	r2, [r3, #8]
 305 0040 039B     		ldr	r3, [sp, #12]
 306 0042 5B68     		ldr	r3, [r3, #4]
 307 0044 9A42     		cmp	r2, r3
 308 0046 03D3     		bcc	.L15
 153:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****       mbp->mb_wrptr = mbp->mb_buffer;
 309              		.loc 1 153 0
 310 0048 039B     		ldr	r3, [sp, #12]
 311 004a 1A68     		ldr	r2, [r3]
 312 004c 039B     		ldr	r3, [sp, #12]
 313 004e 9A60     		str	r2, [r3, #8]
 314              	.L15:
 154:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     chSemSignalI(&mbp->mb_fullsem);
 315              		.loc 1 154 0
 316 0050 039B     		ldr	r3, [sp, #12]
 317 0052 1033     		adds	r3, r3, #16
 318 0054 1846     		mov	r0, r3
 319 0056 FFF7FEFF 		bl	chSemSignalI
 155:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     chSchRescheduleS();
 320              		.loc 1 155 0
 321 005a FFF7FEFF 		bl	chSchRescheduleS
 322              	.L14:
 156:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   }
 157:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return rdymsg;
 323              		.loc 1 157 0
 324 005e 059B     		ldr	r3, [sp, #20]
 158:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 325              		.loc 1 158 0
 326 0060 1846     		mov	r0, r3
 327 0062 07B0     		add	sp, sp, #28
 328              		@ sp needed
 329 0064 5DF804FB 		ldr	pc, [sp], #4
 330              	.L18:
 331              		.align	2
 332              	.L17:
 333 0068 20000000 		.word	.LC2
 334              		.cfi_endproc
 335              	.LFE10:
 337 006c AFF30080 		.section	.rodata
 338 002e 0000     		.align	2
 339              	.LC3:
 340 0030 2263684D 		.ascii	"\"chMBPostI\"()\000"
 340      42506F73 
 340      74492228 
 340      2900
 341              		.section	.text.chMBPostI,"ax",%progbits
 342              		.align	2
 343              		.p2align 4,,15
 344              		.global	chMBPostI
 345              		.thumb
 346              		.thumb_func
 348              	chMBPostI:
 349              	.LFB11:
 159:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 160:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 161:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Posts a message into a mailbox.
 162:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details This variant is non-blocking, the function returns a timeout
 163:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          condition if the queue is full.
 164:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 165:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 166:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] msg       the message to be posted on the mailbox
 167:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 168:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly posted.
 169:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the mailbox is full and the message cannot be
 170:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      posted.
 171:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 172:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @iclass
 173:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 174:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBPostI(Mailbox *mbp, msg_t msg) {
 350              		.loc 1 174 0
 351              		.cfi_startproc
 352              		@ args = 0, pretend = 0, frame = 8
 353              		@ frame_needed = 0, uses_anonymous_args = 0
 354 0000 00B5     		push	{lr}
 355              		.cfi_def_cfa_offset 4
 356              		.cfi_offset 14, -4
 357 0002 83B0     		sub	sp, sp, #12
 358              		.cfi_def_cfa_offset 16
 359 0004 0190     		str	r0, [sp, #4]
 360 0006 0091     		str	r1, [sp]
 175:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 176:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheckClassI();
 361              		.loc 1 176 0
 362 0008 FFF7FEFF 		bl	chDbgCheckClassI
 177:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck(mbp != NULL, "chMBPostI");
 363              		.loc 1 177 0
 364 000c 019B     		ldr	r3, [sp, #4]
 365 000e 002B     		cmp	r3, #0
 366 0010 02D1     		bne	.L20
 367              		.loc 1 177 0 is_stmt 0 discriminator 1
 368 0012 1548     		ldr	r0, .L24
 369 0014 FFF7FEFF 		bl	chDbgPanic
 370              	.L20:
 178:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 179:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (chSemGetCounterI(&mbp->mb_emptysem) <= 0)
 371              		.loc 1 179 0 is_stmt 1
 372 0018 019B     		ldr	r3, [sp, #4]
 373 001a 5B6A     		ldr	r3, [r3, #36]
 374 001c 002B     		cmp	r3, #0
 375 001e 02DC     		bgt	.L21
 180:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     return RDY_TIMEOUT;
 376              		.loc 1 180 0
 377 0020 4FF0FF33 		mov	r3, #-1
 378 0024 1BE0     		b	.L22
 379              	.L21:
 181:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemFastWaitI(&mbp->mb_emptysem);
 380              		.loc 1 181 0
 381 0026 019B     		ldr	r3, [sp, #4]
 382 0028 5B6A     		ldr	r3, [r3, #36]
 383 002a 5A1E     		subs	r2, r3, #1
 384 002c 019B     		ldr	r3, [sp, #4]
 385 002e 5A62     		str	r2, [r3, #36]
 182:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   *mbp->mb_wrptr++ = msg;
 386              		.loc 1 182 0
 387 0030 019B     		ldr	r3, [sp, #4]
 388 0032 9B68     		ldr	r3, [r3, #8]
 389 0034 191D     		adds	r1, r3, #4
 390 0036 019A     		ldr	r2, [sp, #4]
 391 0038 9160     		str	r1, [r2, #8]
 392 003a 009A     		ldr	r2, [sp]
 393 003c 1A60     		str	r2, [r3]
 183:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (mbp->mb_wrptr >= mbp->mb_top)
 394              		.loc 1 183 0
 395 003e 019B     		ldr	r3, [sp, #4]
 396 0040 9A68     		ldr	r2, [r3, #8]
 397 0042 019B     		ldr	r3, [sp, #4]
 398 0044 5B68     		ldr	r3, [r3, #4]
 399 0046 9A42     		cmp	r2, r3
 400 0048 03D3     		bcc	.L23
 184:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     mbp->mb_wrptr = mbp->mb_buffer;
 401              		.loc 1 184 0
 402 004a 019B     		ldr	r3, [sp, #4]
 403 004c 1A68     		ldr	r2, [r3]
 404 004e 019B     		ldr	r3, [sp, #4]
 405 0050 9A60     		str	r2, [r3, #8]
 406              	.L23:
 185:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemSignalI(&mbp->mb_fullsem);
 407              		.loc 1 185 0
 408 0052 019B     		ldr	r3, [sp, #4]
 409 0054 1033     		adds	r3, r3, #16
 410 0056 1846     		mov	r0, r3
 411 0058 FFF7FEFF 		bl	chSemSignalI
 186:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return RDY_OK;
 412              		.loc 1 186 0
 413 005c 0023     		movs	r3, #0
 414              	.L22:
 187:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 415              		.loc 1 187 0
 416 005e 1846     		mov	r0, r3
 417 0060 03B0     		add	sp, sp, #12
 418              		@ sp needed
 419 0062 5DF804FB 		ldr	pc, [sp], #4
 420              	.L25:
 421 0066 00BF     		.align	2
 422              	.L24:
 423 0068 30000000 		.word	.LC3
 424              		.cfi_endproc
 425              	.LFE11:
 427 006c AFF30080 		.section	.text.chMBPostAhead,"ax",%progbits
 428              		.align	2
 429              		.p2align 4,,15
 430              		.global	chMBPostAhead
 431              		.thumb
 432              		.thumb_func
 434              	chMBPostAhead:
 435              	.LFB12:
 188:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 189:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 190:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Posts an high priority message into a mailbox.
 191:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details The invoking thread waits until a empty slot in the mailbox becomes
 192:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          available or the specified time runs out.
 193:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 194:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 195:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] msg       the message to be posted on the mailbox
 196:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] time      the number of ticks before the operation timeouts,
 197:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      the following special values are allowed:
 198:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 199:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_INFINITE no timeout.
 200:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      .
 201:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 202:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly posted.
 203:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_RESET    if the mailbox has been reset while waiting.
 204:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the operation has timed out.
 205:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 206:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @api
 207:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 208:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBPostAhead(Mailbox *mbp, msg_t msg, systime_t time) {
 436              		.loc 1 208 0
 437              		.cfi_startproc
 438              		@ args = 0, pretend = 0, frame = 24
 439              		@ frame_needed = 0, uses_anonymous_args = 0
 440 0000 00B5     		push	{lr}
 441              		.cfi_def_cfa_offset 4
 442              		.cfi_offset 14, -4
 443 0002 87B0     		sub	sp, sp, #28
 444              		.cfi_def_cfa_offset 32
 445 0004 0390     		str	r0, [sp, #12]
 446 0006 0291     		str	r1, [sp, #8]
 447 0008 0192     		str	r2, [sp, #4]
 448              	.LBB6:
 209:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   msg_t rdymsg;
 210:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 211:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysLock();
 449              		.loc 1 211 0
 450 000a 2023     		movs	r3, #32
 451              	@ 211 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 452 000c 83F31188 		msr     BASEPRI, r3
 453              	@ 0 "" 2
 454              		.thumb
 455              	.LBE6:
 456 0010 FFF7FEFF 		bl	dbg_check_lock
 212:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   rdymsg = chMBPostAheadS(mbp, msg, time);
 457              		.loc 1 212 0
 458 0014 0398     		ldr	r0, [sp, #12]
 459 0016 0299     		ldr	r1, [sp, #8]
 460 0018 019A     		ldr	r2, [sp, #4]
 461 001a FFF7FEFF 		bl	chMBPostAheadS
 462 001e 0590     		str	r0, [sp, #20]
 213:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysUnlock();
 463              		.loc 1 213 0
 464 0020 FFF7FEFF 		bl	dbg_check_unlock
 465              	.LBB7:
 466 0024 0023     		movs	r3, #0
 467              	@ 213 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 468 0026 83F31188 		msr     BASEPRI, r3
 469              	@ 0 "" 2
 470              		.thumb
 471              	.LBE7:
 214:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return rdymsg;
 472              		.loc 1 214 0
 473 002a 059B     		ldr	r3, [sp, #20]
 215:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 474              		.loc 1 215 0
 475 002c 1846     		mov	r0, r3
 476 002e 07B0     		add	sp, sp, #28
 477              		@ sp needed
 478 0030 5DF804FB 		ldr	pc, [sp], #4
 479              		.cfi_endproc
 480              	.LFE12:
 482 0034 AFF30080 		.section	.rodata
 482      AFF30080 
 482      AFF30080 
 483 003e 0000     		.align	2
 484              	.LC4:
 485 0040 2263684D 		.ascii	"\"chMBPostAheadS\"()\000"
 485      42506F73 
 485      74416865 
 485      61645322 
 485      282900
 486              		.section	.text.chMBPostAheadS,"ax",%progbits
 487              		.align	2
 488              		.p2align 4,,15
 489              		.global	chMBPostAheadS
 490              		.thumb
 491              		.thumb_func
 493              	chMBPostAheadS:
 494              	.LFB13:
 216:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 217:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 218:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Posts an high priority message into a mailbox.
 219:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details The invoking thread waits until a empty slot in the mailbox becomes
 220:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          available or the specified time runs out.
 221:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 222:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 223:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] msg       the message to be posted on the mailbox
 224:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] time      the number of ticks before the operation timeouts,
 225:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      the following special values are allowed:
 226:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 227:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_INFINITE no timeout.
 228:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      .
 229:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 230:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly posted.
 231:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_RESET    if the mailbox has been reset while waiting.
 232:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the operation has timed out.
 233:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 234:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @sclass
 235:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 236:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBPostAheadS(Mailbox *mbp, msg_t msg, systime_t time) {
 495              		.loc 1 236 0
 496              		.cfi_startproc
 497              		@ args = 0, pretend = 0, frame = 24
 498              		@ frame_needed = 0, uses_anonymous_args = 0
 499 0000 00B5     		push	{lr}
 500              		.cfi_def_cfa_offset 4
 501              		.cfi_offset 14, -4
 502 0002 87B0     		sub	sp, sp, #28
 503              		.cfi_def_cfa_offset 32
 504 0004 0390     		str	r0, [sp, #12]
 505 0006 0291     		str	r1, [sp, #8]
 506 0008 0192     		str	r2, [sp, #4]
 237:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   msg_t rdymsg;
 238:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 239:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheckClassS();
 507              		.loc 1 239 0
 508 000a FFF7FEFF 		bl	chDbgCheckClassS
 240:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck(mbp != NULL, "chMBPostAheadS");
 509              		.loc 1 240 0
 510 000e 039B     		ldr	r3, [sp, #12]
 511 0010 002B     		cmp	r3, #0
 512 0012 02D1     		bne	.L29
 513              		.loc 1 240 0 is_stmt 0 discriminator 1
 514 0014 1648     		ldr	r0, .L33
 515 0016 FFF7FEFF 		bl	chDbgPanic
 516              	.L29:
 241:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 242:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   rdymsg = chSemWaitTimeoutS(&mbp->mb_emptysem, time);
 517              		.loc 1 242 0 is_stmt 1
 518 001a 039B     		ldr	r3, [sp, #12]
 519 001c 1C33     		adds	r3, r3, #28
 520 001e 1846     		mov	r0, r3
 521 0020 0199     		ldr	r1, [sp, #4]
 522 0022 FFF7FEFF 		bl	chSemWaitTimeoutS
 523 0026 0590     		str	r0, [sp, #20]
 243:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (rdymsg == RDY_OK) {
 524              		.loc 1 243 0
 525 0028 059B     		ldr	r3, [sp, #20]
 526 002a 002B     		cmp	r3, #0
 527 002c 1AD1     		bne	.L30
 244:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     if (--mbp->mb_rdptr < mbp->mb_buffer)
 528              		.loc 1 244 0
 529 002e 039B     		ldr	r3, [sp, #12]
 530 0030 DB68     		ldr	r3, [r3, #12]
 531 0032 1A1F     		subs	r2, r3, #4
 532 0034 039B     		ldr	r3, [sp, #12]
 533 0036 DA60     		str	r2, [r3, #12]
 534 0038 039B     		ldr	r3, [sp, #12]
 535 003a DA68     		ldr	r2, [r3, #12]
 536 003c 039B     		ldr	r3, [sp, #12]
 537 003e 1B68     		ldr	r3, [r3]
 538 0040 9A42     		cmp	r2, r3
 539 0042 04D2     		bcs	.L31
 245:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****       mbp->mb_rdptr = mbp->mb_top - 1;
 540              		.loc 1 245 0
 541 0044 039B     		ldr	r3, [sp, #12]
 542 0046 5B68     		ldr	r3, [r3, #4]
 543 0048 1A1F     		subs	r2, r3, #4
 544 004a 039B     		ldr	r3, [sp, #12]
 545 004c DA60     		str	r2, [r3, #12]
 546              	.L31:
 246:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     *mbp->mb_rdptr = msg;
 547              		.loc 1 246 0
 548 004e 039B     		ldr	r3, [sp, #12]
 549 0050 DB68     		ldr	r3, [r3, #12]
 550 0052 029A     		ldr	r2, [sp, #8]
 551 0054 1A60     		str	r2, [r3]
 247:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     chSemSignalI(&mbp->mb_fullsem);
 552              		.loc 1 247 0
 553 0056 039B     		ldr	r3, [sp, #12]
 554 0058 1033     		adds	r3, r3, #16
 555 005a 1846     		mov	r0, r3
 556 005c FFF7FEFF 		bl	chSemSignalI
 248:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     chSchRescheduleS();
 557              		.loc 1 248 0
 558 0060 FFF7FEFF 		bl	chSchRescheduleS
 559              	.L30:
 249:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   }
 250:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return rdymsg;
 560              		.loc 1 250 0
 561 0064 059B     		ldr	r3, [sp, #20]
 251:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 562              		.loc 1 251 0
 563 0066 1846     		mov	r0, r3
 564 0068 07B0     		add	sp, sp, #28
 565              		@ sp needed
 566 006a 5DF804FB 		ldr	pc, [sp], #4
 567              	.L34:
 568 006e 00BF     		.align	2
 569              	.L33:
 570 0070 40000000 		.word	.LC4
 571              		.cfi_endproc
 572              	.LFE13:
 574 0074 AFF30080 		.section	.rodata
 574      AFF30080 
 574      AFF30080 
 575 0053 00       		.align	2
 576              	.LC5:
 577 0054 2263684D 		.ascii	"\"chMBPostAheadI\"()\000"
 577      42506F73 
 577      74416865 
 577      61644922 
 577      282900
 578              		.section	.text.chMBPostAheadI,"ax",%progbits
 579              		.align	2
 580              		.p2align 4,,15
 581              		.global	chMBPostAheadI
 582              		.thumb
 583              		.thumb_func
 585              	chMBPostAheadI:
 586              	.LFB14:
 252:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 253:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 254:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Posts an high priority message into a mailbox.
 255:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details This variant is non-blocking, the function returns a timeout
 256:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          condition if the queue is full.
 257:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 258:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 259:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] msg       the message to be posted on the mailbox
 260:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 261:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly posted.
 262:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the mailbox is full and the message cannot be
 263:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      posted.
 264:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 265:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @iclass
 266:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 267:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBPostAheadI(Mailbox *mbp, msg_t msg) {
 587              		.loc 1 267 0
 588              		.cfi_startproc
 589              		@ args = 0, pretend = 0, frame = 8
 590              		@ frame_needed = 0, uses_anonymous_args = 0
 591 0000 00B5     		push	{lr}
 592              		.cfi_def_cfa_offset 4
 593              		.cfi_offset 14, -4
 594 0002 83B0     		sub	sp, sp, #12
 595              		.cfi_def_cfa_offset 16
 596 0004 0190     		str	r0, [sp, #4]
 597 0006 0091     		str	r1, [sp]
 268:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 269:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheckClassI();
 598              		.loc 1 269 0
 599 0008 FFF7FEFF 		bl	chDbgCheckClassI
 270:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck(mbp != NULL, "chMBPostAheadI");
 600              		.loc 1 270 0
 601 000c 019B     		ldr	r3, [sp, #4]
 602 000e 002B     		cmp	r3, #0
 603 0010 02D1     		bne	.L36
 604              		.loc 1 270 0 is_stmt 0 discriminator 1
 605 0012 1648     		ldr	r0, .L40
 606 0014 FFF7FEFF 		bl	chDbgPanic
 607              	.L36:
 271:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 272:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (chSemGetCounterI(&mbp->mb_emptysem) <= 0)
 608              		.loc 1 272 0 is_stmt 1
 609 0018 019B     		ldr	r3, [sp, #4]
 610 001a 5B6A     		ldr	r3, [r3, #36]
 611 001c 002B     		cmp	r3, #0
 612 001e 02DC     		bgt	.L37
 273:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     return RDY_TIMEOUT;
 613              		.loc 1 273 0
 614 0020 4FF0FF33 		mov	r3, #-1
 615 0024 1EE0     		b	.L38
 616              	.L37:
 274:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemFastWaitI(&mbp->mb_emptysem);
 617              		.loc 1 274 0
 618 0026 019B     		ldr	r3, [sp, #4]
 619 0028 5B6A     		ldr	r3, [r3, #36]
 620 002a 5A1E     		subs	r2, r3, #1
 621 002c 019B     		ldr	r3, [sp, #4]
 622 002e 5A62     		str	r2, [r3, #36]
 275:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (--mbp->mb_rdptr < mbp->mb_buffer)
 623              		.loc 1 275 0
 624 0030 019B     		ldr	r3, [sp, #4]
 625 0032 DB68     		ldr	r3, [r3, #12]
 626 0034 1A1F     		subs	r2, r3, #4
 627 0036 019B     		ldr	r3, [sp, #4]
 628 0038 DA60     		str	r2, [r3, #12]
 629 003a 019B     		ldr	r3, [sp, #4]
 630 003c DA68     		ldr	r2, [r3, #12]
 631 003e 019B     		ldr	r3, [sp, #4]
 632 0040 1B68     		ldr	r3, [r3]
 633 0042 9A42     		cmp	r2, r3
 634 0044 04D2     		bcs	.L39
 276:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     mbp->mb_rdptr = mbp->mb_top - 1;
 635              		.loc 1 276 0
 636 0046 019B     		ldr	r3, [sp, #4]
 637 0048 5B68     		ldr	r3, [r3, #4]
 638 004a 1A1F     		subs	r2, r3, #4
 639 004c 019B     		ldr	r3, [sp, #4]
 640 004e DA60     		str	r2, [r3, #12]
 641              	.L39:
 277:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   *mbp->mb_rdptr = msg;
 642              		.loc 1 277 0
 643 0050 019B     		ldr	r3, [sp, #4]
 644 0052 DB68     		ldr	r3, [r3, #12]
 645 0054 009A     		ldr	r2, [sp]
 646 0056 1A60     		str	r2, [r3]
 278:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemSignalI(&mbp->mb_fullsem);
 647              		.loc 1 278 0
 648 0058 019B     		ldr	r3, [sp, #4]
 649 005a 1033     		adds	r3, r3, #16
 650 005c 1846     		mov	r0, r3
 651 005e FFF7FEFF 		bl	chSemSignalI
 279:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return RDY_OK;
 652              		.loc 1 279 0
 653 0062 0023     		movs	r3, #0
 654              	.L38:
 280:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 655              		.loc 1 280 0
 656 0064 1846     		mov	r0, r3
 657 0066 03B0     		add	sp, sp, #12
 658              		@ sp needed
 659 0068 5DF804FB 		ldr	pc, [sp], #4
 660              	.L41:
 661              		.align	2
 662              	.L40:
 663 006c 54000000 		.word	.LC5
 664              		.cfi_endproc
 665              	.LFE14:
 667              		.section	.text.chMBFetch,"ax",%progbits
 668              		.align	2
 669              		.p2align 4,,15
 670              		.global	chMBFetch
 671              		.thumb
 672              		.thumb_func
 674              	chMBFetch:
 675              	.LFB15:
 281:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 282:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 283:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Retrieves a message from a mailbox.
 284:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details The invoking thread waits until a message is posted in the mailbox
 285:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          or the specified time runs out.
 286:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 287:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 288:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[out] msgp     pointer to a message variable for the received message
 289:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] time      the number of ticks before the operation timeouts,
 290:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      the following special values are allowed:
 291:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 292:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_INFINITE no timeout.
 293:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      .
 294:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 295:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly fetched.
 296:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_RESET    if the mailbox has been reset while waiting.
 297:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the operation has timed out.
 298:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 299:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @api
 300:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 301:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBFetch(Mailbox *mbp, msg_t *msgp, systime_t time) {
 676              		.loc 1 301 0
 677              		.cfi_startproc
 678              		@ args = 0, pretend = 0, frame = 24
 679              		@ frame_needed = 0, uses_anonymous_args = 0
 680 0000 00B5     		push	{lr}
 681              		.cfi_def_cfa_offset 4
 682              		.cfi_offset 14, -4
 683 0002 87B0     		sub	sp, sp, #28
 684              		.cfi_def_cfa_offset 32
 685 0004 0390     		str	r0, [sp, #12]
 686 0006 0291     		str	r1, [sp, #8]
 687 0008 0192     		str	r2, [sp, #4]
 688              	.LBB8:
 302:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   msg_t rdymsg;
 303:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 304:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysLock();
 689              		.loc 1 304 0
 690 000a 2023     		movs	r3, #32
 691              	@ 304 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 692 000c 83F31188 		msr     BASEPRI, r3
 693              	@ 0 "" 2
 694              		.thumb
 695              	.LBE8:
 696 0010 FFF7FEFF 		bl	dbg_check_lock
 305:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   rdymsg = chMBFetchS(mbp, msgp, time);
 697              		.loc 1 305 0
 698 0014 0398     		ldr	r0, [sp, #12]
 699 0016 0299     		ldr	r1, [sp, #8]
 700 0018 019A     		ldr	r2, [sp, #4]
 701 001a FFF7FEFF 		bl	chMBFetchS
 702 001e 0590     		str	r0, [sp, #20]
 306:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSysUnlock();
 703              		.loc 1 306 0
 704 0020 FFF7FEFF 		bl	dbg_check_unlock
 705              	.LBB9:
 706 0024 0023     		movs	r3, #0
 707              	@ 306 "/usr/src/chibiostest/os/kernel/src/chmboxes.c" 1
 708 0026 83F31188 		msr     BASEPRI, r3
 709              	@ 0 "" 2
 710              		.thumb
 711              	.LBE9:
 307:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return rdymsg;
 712              		.loc 1 307 0
 713 002a 059B     		ldr	r3, [sp, #20]
 308:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 714              		.loc 1 308 0
 715 002c 1846     		mov	r0, r3
 716 002e 07B0     		add	sp, sp, #28
 717              		@ sp needed
 718 0030 5DF804FB 		ldr	pc, [sp], #4
 719              		.cfi_endproc
 720              	.LFE15:
 722 0034 AFF30080 		.section	.rodata
 722      AFF30080 
 722      AFF30080 
 723 0067 00       		.align	2
 724              	.LC6:
 725 0068 2263684D 		.ascii	"\"chMBFetchS\"()\000"
 725      42466574 
 725      63685322 
 725      282900
 726              		.section	.text.chMBFetchS,"ax",%progbits
 727              		.align	2
 728              		.p2align 4,,15
 729              		.global	chMBFetchS
 730              		.thumb
 731              		.thumb_func
 733              	chMBFetchS:
 734              	.LFB16:
 309:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 310:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 311:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Retrieves a message from a mailbox.
 312:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details The invoking thread waits until a message is posted in the mailbox
 313:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          or the specified time runs out.
 314:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 315:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 316:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[out] msgp     pointer to a message variable for the received message
 317:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] time      the number of ticks before the operation timeouts,
 318:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      the following special values are allowed:
 319:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_IMMEDIATE immediate timeout.
 320:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      - @a TIME_INFINITE no timeout.
 321:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      .
 322:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 323:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly fetched.
 324:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_RESET    if the mailbox has been reset while waiting.
 325:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the operation has timed out.
 326:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 327:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @sclass
 328:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 329:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBFetchS(Mailbox *mbp, msg_t *msgp, systime_t time) {
 735              		.loc 1 329 0
 736              		.cfi_startproc
 737              		@ args = 0, pretend = 0, frame = 24
 738              		@ frame_needed = 0, uses_anonymous_args = 0
 739 0000 00B5     		push	{lr}
 740              		.cfi_def_cfa_offset 4
 741              		.cfi_offset 14, -4
 742 0002 87B0     		sub	sp, sp, #28
 743              		.cfi_def_cfa_offset 32
 744 0004 0390     		str	r0, [sp, #12]
 745 0006 0291     		str	r1, [sp, #8]
 746 0008 0192     		str	r2, [sp, #4]
 330:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   msg_t rdymsg;
 331:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 332:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheckClassS();
 747              		.loc 1 332 0
 748 000a FFF7FEFF 		bl	chDbgCheckClassS
 333:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck((mbp != NULL) && (msgp != NULL), "chMBFetchS");
 749              		.loc 1 333 0
 750 000e 039B     		ldr	r3, [sp, #12]
 751 0010 002B     		cmp	r3, #0
 752 0012 02D0     		beq	.L45
 753              		.loc 1 333 0 is_stmt 0 discriminator 2
 754 0014 029B     		ldr	r3, [sp, #8]
 755 0016 002B     		cmp	r3, #0
 756 0018 02D1     		bne	.L46
 757              	.L45:
 758              		.loc 1 333 0 discriminator 1
 759 001a 1548     		ldr	r0, .L50
 760 001c FFF7FEFF 		bl	chDbgPanic
 761              	.L46:
 334:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 335:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   rdymsg = chSemWaitTimeoutS(&mbp->mb_fullsem, time);
 762              		.loc 1 335 0 is_stmt 1
 763 0020 039B     		ldr	r3, [sp, #12]
 764 0022 1033     		adds	r3, r3, #16
 765 0024 1846     		mov	r0, r3
 766 0026 0199     		ldr	r1, [sp, #4]
 767 0028 FFF7FEFF 		bl	chSemWaitTimeoutS
 768 002c 0590     		str	r0, [sp, #20]
 336:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (rdymsg == RDY_OK) {
 769              		.loc 1 336 0
 770 002e 059B     		ldr	r3, [sp, #20]
 771 0030 002B     		cmp	r3, #0
 772 0032 18D1     		bne	.L47
 337:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     *msgp = *mbp->mb_rdptr++;
 773              		.loc 1 337 0
 774 0034 039B     		ldr	r3, [sp, #12]
 775 0036 DB68     		ldr	r3, [r3, #12]
 776 0038 191D     		adds	r1, r3, #4
 777 003a 039A     		ldr	r2, [sp, #12]
 778 003c D160     		str	r1, [r2, #12]
 779 003e 1A68     		ldr	r2, [r3]
 780 0040 029B     		ldr	r3, [sp, #8]
 781 0042 1A60     		str	r2, [r3]
 338:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     if (mbp->mb_rdptr >= mbp->mb_top)
 782              		.loc 1 338 0
 783 0044 039B     		ldr	r3, [sp, #12]
 784 0046 DA68     		ldr	r2, [r3, #12]
 785 0048 039B     		ldr	r3, [sp, #12]
 786 004a 5B68     		ldr	r3, [r3, #4]
 787 004c 9A42     		cmp	r2, r3
 788 004e 03D3     		bcc	.L48
 339:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****       mbp->mb_rdptr = mbp->mb_buffer;
 789              		.loc 1 339 0
 790 0050 039B     		ldr	r3, [sp, #12]
 791 0052 1A68     		ldr	r2, [r3]
 792 0054 039B     		ldr	r3, [sp, #12]
 793 0056 DA60     		str	r2, [r3, #12]
 794              	.L48:
 340:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     chSemSignalI(&mbp->mb_emptysem);
 795              		.loc 1 340 0
 796 0058 039B     		ldr	r3, [sp, #12]
 797 005a 1C33     		adds	r3, r3, #28
 798 005c 1846     		mov	r0, r3
 799 005e FFF7FEFF 		bl	chSemSignalI
 341:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     chSchRescheduleS();
 800              		.loc 1 341 0
 801 0062 FFF7FEFF 		bl	chSchRescheduleS
 802              	.L47:
 342:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   }
 343:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return rdymsg;
 803              		.loc 1 343 0
 804 0066 059B     		ldr	r3, [sp, #20]
 344:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 805              		.loc 1 344 0
 806 0068 1846     		mov	r0, r3
 807 006a 07B0     		add	sp, sp, #28
 808              		@ sp needed
 809 006c 5DF804FB 		ldr	pc, [sp], #4
 810              	.L51:
 811              		.align	2
 812              	.L50:
 813 0070 68000000 		.word	.LC6
 814              		.cfi_endproc
 815              	.LFE16:
 817 0074 AFF30080 		.section	.rodata
 817      AFF30080 
 817      AFF30080 
 818 0077 00       		.align	2
 819              	.LC7:
 820 0078 2263684D 		.ascii	"\"chMBFetchI\"()\000"
 820      42466574 
 820      63684922 
 820      282900
 821 0087 00       		.section	.text.chMBFetchI,"ax",%progbits
 822              		.align	2
 823              		.p2align 4,,15
 824              		.global	chMBFetchI
 825              		.thumb
 826              		.thumb_func
 828              	chMBFetchI:
 829              	.LFB17:
 345:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 346:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** /**
 347:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @brief   Retrieves a message from a mailbox.
 348:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @details This variant is non-blocking, the function returns a timeout
 349:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *          condition if the queue is empty.
 350:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 351:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[in] mbp       the pointer to an initialized Mailbox object
 352:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @param[out] msgp     pointer to a message variable for the received message
 353:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @return              The operation status.
 354:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_OK       if a message has been correctly fetched.
 355:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @retval RDY_TIMEOUT  if the mailbox is empty and a message cannot be
 356:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *                      fetched.
 357:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  *
 358:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  * @iclass
 359:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****  */
 360:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** msg_t chMBFetchI(Mailbox *mbp, msg_t *msgp) {
 830              		.loc 1 360 0
 831              		.cfi_startproc
 832              		@ args = 0, pretend = 0, frame = 8
 833              		@ frame_needed = 0, uses_anonymous_args = 0
 834 0000 00B5     		push	{lr}
 835              		.cfi_def_cfa_offset 4
 836              		.cfi_offset 14, -4
 837 0002 83B0     		sub	sp, sp, #12
 838              		.cfi_def_cfa_offset 16
 839 0004 0190     		str	r0, [sp, #4]
 840 0006 0091     		str	r1, [sp]
 361:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 362:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheckClassI();
 841              		.loc 1 362 0
 842 0008 FFF7FEFF 		bl	chDbgCheckClassI
 363:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chDbgCheck((mbp != NULL) && (msgp != NULL), "chMBFetchI");
 843              		.loc 1 363 0
 844 000c 019B     		ldr	r3, [sp, #4]
 845 000e 002B     		cmp	r3, #0
 846 0010 02D0     		beq	.L53
 847              		.loc 1 363 0 is_stmt 0 discriminator 2
 848 0012 009B     		ldr	r3, [sp]
 849 0014 002B     		cmp	r3, #0
 850 0016 02D1     		bne	.L54
 851              	.L53:
 852              		.loc 1 363 0 discriminator 1
 853 0018 1548     		ldr	r0, .L58
 854 001a FFF7FEFF 		bl	chDbgPanic
 855              	.L54:
 364:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** 
 365:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (chSemGetCounterI(&mbp->mb_fullsem) <= 0)
 856              		.loc 1 365 0 is_stmt 1
 857 001e 019B     		ldr	r3, [sp, #4]
 858 0020 9B69     		ldr	r3, [r3, #24]
 859 0022 002B     		cmp	r3, #0
 860 0024 02DC     		bgt	.L55
 366:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     return RDY_TIMEOUT;
 861              		.loc 1 366 0
 862 0026 4FF0FF33 		mov	r3, #-1
 863 002a 1CE0     		b	.L56
 864              	.L55:
 367:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemFastWaitI(&mbp->mb_fullsem);
 865              		.loc 1 367 0
 866 002c 019B     		ldr	r3, [sp, #4]
 867 002e 9B69     		ldr	r3, [r3, #24]
 868 0030 5A1E     		subs	r2, r3, #1
 869 0032 019B     		ldr	r3, [sp, #4]
 870 0034 9A61     		str	r2, [r3, #24]
 368:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   *msgp = *mbp->mb_rdptr++;
 871              		.loc 1 368 0
 872 0036 019B     		ldr	r3, [sp, #4]
 873 0038 DB68     		ldr	r3, [r3, #12]
 874 003a 191D     		adds	r1, r3, #4
 875 003c 019A     		ldr	r2, [sp, #4]
 876 003e D160     		str	r1, [r2, #12]
 877 0040 1A68     		ldr	r2, [r3]
 878 0042 009B     		ldr	r3, [sp]
 879 0044 1A60     		str	r2, [r3]
 369:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   if (mbp->mb_rdptr >= mbp->mb_top)
 880              		.loc 1 369 0
 881 0046 019B     		ldr	r3, [sp, #4]
 882 0048 DA68     		ldr	r2, [r3, #12]
 883 004a 019B     		ldr	r3, [sp, #4]
 884 004c 5B68     		ldr	r3, [r3, #4]
 885 004e 9A42     		cmp	r2, r3
 886 0050 03D3     		bcc	.L57
 370:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****     mbp->mb_rdptr = mbp->mb_buffer;
 887              		.loc 1 370 0
 888 0052 019B     		ldr	r3, [sp, #4]
 889 0054 1A68     		ldr	r2, [r3]
 890 0056 019B     		ldr	r3, [sp, #4]
 891 0058 DA60     		str	r2, [r3, #12]
 892              	.L57:
 371:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   chSemSignalI(&mbp->mb_emptysem);
 893              		.loc 1 371 0
 894 005a 019B     		ldr	r3, [sp, #4]
 895 005c 1C33     		adds	r3, r3, #28
 896 005e 1846     		mov	r0, r3
 897 0060 FFF7FEFF 		bl	chSemSignalI
 372:/usr/src/chibiostest/os/kernel/src/chmboxes.c ****   return RDY_OK;
 898              		.loc 1 372 0
 899 0064 0023     		movs	r3, #0
 900              	.L56:
 373:/usr/src/chibiostest/os/kernel/src/chmboxes.c **** }
 901              		.loc 1 373 0
 902 0066 1846     		mov	r0, r3
 903 0068 03B0     		add	sp, sp, #12
 904              		@ sp needed
 905 006a 5DF804FB 		ldr	pc, [sp], #4
 906              	.L59:
 907 006e 00BF     		.align	2
 908              	.L58:
 909 0070 78000000 		.word	.LC7
 910              		.cfi_endproc
 911              	.LFE17:
 913 0074 AFF30080 		.text
 913      AFF30080 
 913      AFF30080 
 914              	.Letext0:
 915              		.file 2 "/usr/include/newlib/machine/_default_types.h"
 916              		.file 3 "/usr/include/newlib/stdint.h"
 917              		.file 4 "/usr/src/chibiostest/os/ports/GCC/ARMCMx/chtypes.h"
 918              		.file 5 "/usr/src/chibiostest/os/kernel/include/chlists.h"
 919              		.file 6 "/usr/src/chibiostest/os/kernel/include/chthreads.h"
 920              		.file 7 "/usr/src/chibiostest/os/ports/GCC/ARMCMx/chcore_v7m.h"
 921              		.file 8 "/usr/src/chibiostest/os/kernel/include/chsem.h"
 922              		.file 9 "/usr/src/chibiostest/os/kernel/include/chmtx.h"
 923              		.file 10 "/usr/src/chibiostest/os/kernel/include/chmboxes.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 chmboxes.c
     /tmp/ccqZklx0.s:20     .rodata:0000000000000000 $d
     /tmp/ccqZklx0.s:24     .text.chMBInit:0000000000000000 $t
     /tmp/ccqZklx0.s:30     .text.chMBInit:0000000000000000 chMBInit
     /tmp/ccqZklx0.s:99     .text.chMBInit:0000000000000064 $d
     /tmp/ccqZklx0.s:108    .text.chMBReset:0000000000000000 $t
     /tmp/ccqZklx0.s:114    .text.chMBReset:0000000000000000 chMBReset
     /tmp/ccqZklx0.s:189    .text.chMBReset:0000000000000068 $d
     /tmp/ccqZklx0.s:194    .text.chMBPost:0000000000000000 $t
     /tmp/ccqZklx0.s:200    .text.chMBPost:0000000000000000 chMBPost
     /tmp/ccqZklx0.s:259    .text.chMBPostS:0000000000000000 chMBPostS
     /tmp/ccqZklx0.s:253    .text.chMBPostS:0000000000000000 $t
     /tmp/ccqZklx0.s:333    .text.chMBPostS:0000000000000068 $d
     /tmp/ccqZklx0.s:342    .text.chMBPostI:0000000000000000 $t
     /tmp/ccqZklx0.s:348    .text.chMBPostI:0000000000000000 chMBPostI
     /tmp/ccqZklx0.s:423    .text.chMBPostI:0000000000000068 $d
     /tmp/ccqZklx0.s:428    .text.chMBPostAhead:0000000000000000 $t
     /tmp/ccqZklx0.s:434    .text.chMBPostAhead:0000000000000000 chMBPostAhead
     /tmp/ccqZklx0.s:493    .text.chMBPostAheadS:0000000000000000 chMBPostAheadS
     /tmp/ccqZklx0.s:487    .text.chMBPostAheadS:0000000000000000 $t
     /tmp/ccqZklx0.s:570    .text.chMBPostAheadS:0000000000000070 $d
     /tmp/ccqZklx0.s:579    .text.chMBPostAheadI:0000000000000000 $t
     /tmp/ccqZklx0.s:585    .text.chMBPostAheadI:0000000000000000 chMBPostAheadI
     /tmp/ccqZklx0.s:663    .text.chMBPostAheadI:000000000000006c $d
     /tmp/ccqZklx0.s:668    .text.chMBFetch:0000000000000000 $t
     /tmp/ccqZklx0.s:674    .text.chMBFetch:0000000000000000 chMBFetch
     /tmp/ccqZklx0.s:733    .text.chMBFetchS:0000000000000000 chMBFetchS
     /tmp/ccqZklx0.s:727    .text.chMBFetchS:0000000000000000 $t
     /tmp/ccqZklx0.s:813    .text.chMBFetchS:0000000000000070 $d
     /tmp/ccqZklx0.s:822    .text.chMBFetchI:0000000000000000 $t
     /tmp/ccqZklx0.s:828    .text.chMBFetchI:0000000000000000 chMBFetchI
     /tmp/ccqZklx0.s:909    .text.chMBFetchI:0000000000000070 $d
                     .debug_frame:0000000000000010 $d
     /tmp/ccqZklx0.s:103    .text.chMBInit:0000000000000068 $t
     /tmp/ccqZklx0.s:193    .text.chMBReset:000000000000006c $t
     /tmp/ccqZklx0.s:337    .text.chMBPostS:000000000000006c $t
     /tmp/ccqZklx0.s:427    .text.chMBPostI:000000000000006c $t
     /tmp/ccqZklx0.s:574    .text.chMBPostAheadS:0000000000000074 $t
     /tmp/ccqZklx0.s:817    .text.chMBFetchS:0000000000000074 $t
     /tmp/ccqZklx0.s:913    .text.chMBFetchI:0000000000000074 $t

UNDEFINED SYMBOLS
chDbgPanic
chSemInit
dbg_check_lock
chSemResetI
chSchRescheduleS
dbg_check_unlock
chDbgCheckClassS
chSemWaitTimeoutS
chSemSignalI
chDbgCheckClassI
