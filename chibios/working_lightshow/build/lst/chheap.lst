   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 3
   4              		.fpu fpv4-sp-d16
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 6
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.thumb
  15              		.file	"chheap.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.bss.default_heap,"aw",%nobits
  20              		.align	3
  23              	default_heap:
  24 0000 00000000 		.space	32
  24      00000000 
  24      00000000 
  24      00000000 
  24      00000000 
  25              		.section	.text._heap_init,"ax",%progbits
  26              		.align	2
  27              		.p2align 4,,15
  28              		.global	_heap_init
  29              		.thumb
  30              		.thumb_func
  32              	_heap_init:
  33              	.LFB7:
  34              		.file 1 "/usr/src/chibiostest/os/kernel/src/chheap.c"
   1:/usr/src/chibiostest/os/kernel/src/chheap.c **** /*
   2:/usr/src/chibiostest/os/kernel/src/chheap.c ****     ChibiOS/RT - Copyright (C) 2006,2007,2008,2009,2010,
   3:/usr/src/chibiostest/os/kernel/src/chheap.c ****                  2011,2012 Giovanni Di Sirio.
   4:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
   5:/usr/src/chibiostest/os/kernel/src/chheap.c ****     This file is part of ChibiOS/RT.
   6:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
   7:/usr/src/chibiostest/os/kernel/src/chheap.c ****     ChibiOS/RT is free software; you can redistribute it and/or modify
   8:/usr/src/chibiostest/os/kernel/src/chheap.c ****     it under the terms of the GNU General Public License as published by
   9:/usr/src/chibiostest/os/kernel/src/chheap.c ****     the Free Software Foundation; either version 3 of the License, or
  10:/usr/src/chibiostest/os/kernel/src/chheap.c ****     (at your option) any later version.
  11:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  12:/usr/src/chibiostest/os/kernel/src/chheap.c ****     ChibiOS/RT is distributed in the hope that it will be useful,
  13:/usr/src/chibiostest/os/kernel/src/chheap.c ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  14:/usr/src/chibiostest/os/kernel/src/chheap.c ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  15:/usr/src/chibiostest/os/kernel/src/chheap.c ****     GNU General Public License for more details.
  16:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  17:/usr/src/chibiostest/os/kernel/src/chheap.c ****     You should have received a copy of the GNU General Public License
  18:/usr/src/chibiostest/os/kernel/src/chheap.c ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  19:/usr/src/chibiostest/os/kernel/src/chheap.c **** */
  20:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  21:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
  22:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @file    chheap.c
  23:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Heaps code.
  24:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
  25:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @addtogroup heaps
  26:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @details Heap Allocator related APIs.
  27:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          <h2>Operation mode</h2>
  28:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          The heap allocator implements a first-fit strategy and its APIs
  29:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          are functionally equivalent to the usual @p malloc() and @p free()
  30:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          library functions. The main difference is that the OS heap APIs
  31:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          are guaranteed to be thread safe.<br>
  32:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          By enabling the @p CH_USE_MALLOC_HEAP option the heap manager
  33:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          will use the runtime-provided @p malloc() and @p free() as
  34:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          back end for the heap APIs instead of the system provided
  35:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          allocator.
  36:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @pre     In order to use the heap APIs the @p CH_USE_HEAP option must
  37:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          be enabled in @p chconf.h.
  38:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @{
  39:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
  40:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  41:/usr/src/chibiostest/os/kernel/src/chheap.c **** #include "ch.h"
  42:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  43:/usr/src/chibiostest/os/kernel/src/chheap.c **** #if CH_USE_HEAP || defined(__DOXYGEN__)
  44:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  45:/usr/src/chibiostest/os/kernel/src/chheap.c **** #if !CH_USE_MALLOC_HEAP || defined(__DOXYGEN__)
  46:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  47:/usr/src/chibiostest/os/kernel/src/chheap.c **** /*
  48:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * Defaults on the best synchronization mechanism available.
  49:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
  50:/usr/src/chibiostest/os/kernel/src/chheap.c **** #if CH_USE_MUTEXES || defined(__DOXYGEN__)
  51:/usr/src/chibiostest/os/kernel/src/chheap.c **** #define H_LOCK(h)       chMtxLock(&(h)->h_mtx)
  52:/usr/src/chibiostest/os/kernel/src/chheap.c **** #define H_UNLOCK(h)     chMtxUnlock()
  53:/usr/src/chibiostest/os/kernel/src/chheap.c **** #else
  54:/usr/src/chibiostest/os/kernel/src/chheap.c **** #define H_LOCK(h)       chSemWait(&(h)->h_sem)
  55:/usr/src/chibiostest/os/kernel/src/chheap.c **** #define H_UNLOCK(h)     chSemSignal(&(h)->h_sem)
  56:/usr/src/chibiostest/os/kernel/src/chheap.c **** #endif
  57:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  58:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
  59:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Default heap descriptor.
  60:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
  61:/usr/src/chibiostest/os/kernel/src/chheap.c **** static MemoryHeap default_heap;
  62:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  63:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
  64:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Initializes the default heap.
  65:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
  66:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @notapi
  67:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
  68:/usr/src/chibiostest/os/kernel/src/chheap.c **** void _heap_init(void) {
  35              		.loc 1 68 0
  36              		.cfi_startproc
  37              		@ args = 0, pretend = 0, frame = 0
  38              		@ frame_needed = 0, uses_anonymous_args = 0
  39 0000 08B5     		push	{r3, lr}
  40              		.cfi_def_cfa_offset 8
  41              		.cfi_offset 3, -8
  42              		.cfi_offset 14, -4
  69:/usr/src/chibiostest/os/kernel/src/chheap.c ****   default_heap.h_provider = chCoreAlloc;
  43              		.loc 1 69 0
  44 0002 064B     		ldr	r3, .L2
  45 0004 064A     		ldr	r2, .L2+4
  46 0006 1A60     		str	r2, [r3]
  70:/usr/src/chibiostest/os/kernel/src/chheap.c ****   default_heap.h_free.h.u.next = (union heap_header *)NULL;
  47              		.loc 1 70 0
  48 0008 044B     		ldr	r3, .L2
  49 000a 0022     		movs	r2, #0
  50 000c 9A60     		str	r2, [r3, #8]
  71:/usr/src/chibiostest/os/kernel/src/chheap.c ****   default_heap.h_free.h.size = 0;
  51              		.loc 1 71 0
  52 000e 034B     		ldr	r3, .L2
  53 0010 0022     		movs	r2, #0
  54 0012 DA60     		str	r2, [r3, #12]
  72:/usr/src/chibiostest/os/kernel/src/chheap.c **** #if CH_USE_MUTEXES || defined(__DOXYGEN__)
  73:/usr/src/chibiostest/os/kernel/src/chheap.c ****   chMtxInit(&default_heap.h_mtx);
  55              		.loc 1 73 0
  56 0014 0348     		ldr	r0, .L2+8
  57 0016 FFF7FEFF 		bl	chMtxInit
  74:/usr/src/chibiostest/os/kernel/src/chheap.c **** #else
  75:/usr/src/chibiostest/os/kernel/src/chheap.c ****   chSemInit(&default_heap.h_sem, 1);
  76:/usr/src/chibiostest/os/kernel/src/chheap.c **** #endif
  77:/usr/src/chibiostest/os/kernel/src/chheap.c **** }
  58              		.loc 1 77 0
  59 001a 08BD     		pop	{r3, pc}
  60              	.L3:
  61              		.align	2
  62              	.L2:
  63 001c 00000000 		.word	default_heap
  64 0020 00000000 		.word	chCoreAlloc
  65 0024 10000000 		.word	default_heap+16
  66              		.cfi_endproc
  67              	.LFE7:
  69 0028 AFF30080 		.section	.rodata
  69      AFF30080 
  70              		.align	2
  71              	.LC0:
  72 0000 22636848 		.ascii	"\"chHeapInit\"()\000"
  72      65617049 
  72      6E697422 
  72      282900
  73              		.section	.text.chHeapInit,"ax",%progbits
  74              		.align	2
  75              		.p2align 4,,15
  76              		.global	chHeapInit
  77              		.thumb
  78              		.thumb_func
  80              	chHeapInit:
  81              	.LFB8:
  78:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  79:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
  80:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Initializes a memory heap from a static memory area.
  81:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @pre     Both the heap buffer base and the heap size must be aligned to
  82:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          the @p stkalign_t type size.
  83:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @pre     In order to use this function the option @p CH_USE_MALLOC_HEAP
  84:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          must be disabled.
  85:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
  86:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[out] heapp    pointer to the memory heap descriptor to be initialized
  87:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] buf       heap buffer base
  88:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] size      heap size
  89:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
  90:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @init
  91:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
  92:/usr/src/chibiostest/os/kernel/src/chheap.c **** void chHeapInit(MemoryHeap *heapp, void *buf, size_t size) {
  82              		.loc 1 92 0
  83              		.cfi_startproc
  84              		@ args = 0, pretend = 0, frame = 24
  85              		@ frame_needed = 0, uses_anonymous_args = 0
  86 0000 00B5     		push	{lr}
  87              		.cfi_def_cfa_offset 4
  88              		.cfi_offset 14, -4
  89 0002 87B0     		sub	sp, sp, #28
  90              		.cfi_def_cfa_offset 32
  91 0004 0390     		str	r0, [sp, #12]
  92 0006 0291     		str	r1, [sp, #8]
  93 0008 0192     		str	r2, [sp, #4]
  93:/usr/src/chibiostest/os/kernel/src/chheap.c ****   union heap_header *hp;
  94:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  95:/usr/src/chibiostest/os/kernel/src/chheap.c ****   chDbgCheck(MEM_IS_ALIGNED(buf) && MEM_IS_ALIGNED(size), "chHeapInit");
  94              		.loc 1 95 0
  95 000a 029B     		ldr	r3, [sp, #8]
  96 000c 03F00703 		and	r3, r3, #7
  97 0010 002B     		cmp	r3, #0
  98 0012 04D1     		bne	.L5
  99              		.loc 1 95 0 is_stmt 0 discriminator 2
 100 0014 019B     		ldr	r3, [sp, #4]
 101 0016 03F00703 		and	r3, r3, #7
 102 001a 002B     		cmp	r3, #0
 103 001c 02D0     		beq	.L6
 104              	.L5:
 105              		.loc 1 95 0 discriminator 1
 106 001e 0F48     		ldr	r0, .L7
 107 0020 FFF7FEFF 		bl	chDbgPanic
 108              	.L6:
  96:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
  97:/usr/src/chibiostest/os/kernel/src/chheap.c ****   heapp->h_provider = (memgetfunc_t)NULL;
 109              		.loc 1 97 0 is_stmt 1
 110 0024 039B     		ldr	r3, [sp, #12]
 111 0026 0022     		movs	r2, #0
 112 0028 1A60     		str	r2, [r3]
  98:/usr/src/chibiostest/os/kernel/src/chheap.c ****   heapp->h_free.h.u.next = hp = buf;
 113              		.loc 1 98 0
 114 002a 029B     		ldr	r3, [sp, #8]
 115 002c 0593     		str	r3, [sp, #20]
 116 002e 039B     		ldr	r3, [sp, #12]
 117 0030 059A     		ldr	r2, [sp, #20]
 118 0032 9A60     		str	r2, [r3, #8]
  99:/usr/src/chibiostest/os/kernel/src/chheap.c ****   heapp->h_free.h.size = 0;
 119              		.loc 1 99 0
 120 0034 039B     		ldr	r3, [sp, #12]
 121 0036 0022     		movs	r2, #0
 122 0038 DA60     		str	r2, [r3, #12]
 100:/usr/src/chibiostest/os/kernel/src/chheap.c ****   hp->h.u.next = NULL;
 123              		.loc 1 100 0
 124 003a 059B     		ldr	r3, [sp, #20]
 125 003c 0022     		movs	r2, #0
 126 003e 1A60     		str	r2, [r3]
 101:/usr/src/chibiostest/os/kernel/src/chheap.c ****   hp->h.size = size - sizeof(union heap_header);
 127              		.loc 1 101 0
 128 0040 019B     		ldr	r3, [sp, #4]
 129 0042 A3F10802 		sub	r2, r3, #8
 130 0046 059B     		ldr	r3, [sp, #20]
 131 0048 5A60     		str	r2, [r3, #4]
 102:/usr/src/chibiostest/os/kernel/src/chheap.c **** #if CH_USE_MUTEXES || defined(__DOXYGEN__)
 103:/usr/src/chibiostest/os/kernel/src/chheap.c ****   chMtxInit(&heapp->h_mtx);
 132              		.loc 1 103 0
 133 004a 039B     		ldr	r3, [sp, #12]
 134 004c 1033     		adds	r3, r3, #16
 135 004e 1846     		mov	r0, r3
 136 0050 FFF7FEFF 		bl	chMtxInit
 104:/usr/src/chibiostest/os/kernel/src/chheap.c **** #else
 105:/usr/src/chibiostest/os/kernel/src/chheap.c ****   chSemInit(&heapp->h_sem, 1);
 106:/usr/src/chibiostest/os/kernel/src/chheap.c **** #endif
 107:/usr/src/chibiostest/os/kernel/src/chheap.c **** }
 137              		.loc 1 107 0
 138 0054 07B0     		add	sp, sp, #28
 139              		@ sp needed
 140 0056 5DF804FB 		ldr	pc, [sp], #4
 141              	.L8:
 142 005a 00BF     		.align	2
 143              	.L7:
 144 005c 00000000 		.word	.LC0
 145              		.cfi_endproc
 146              	.LFE8:
 148              		.section	.text.chHeapAlloc,"ax",%progbits
 149              		.align	2
 150              		.p2align 4,,15
 151              		.global	chHeapAlloc
 152              		.thumb
 153              		.thumb_func
 155              	chHeapAlloc:
 156              	.LFB9:
 108:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 109:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
 110:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Allocates a block of memory from the heap by using the first-fit
 111:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          algorithm.
 112:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @details The allocated block is guaranteed to be properly aligned for a
 113:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          pointer data type (@p stkalign_t).
 114:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
 115:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] heapp     pointer to a heap descriptor or @p NULL in order to
 116:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *                      access the default heap.
 117:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] size      the size of the block to be allocated. Note that the
 118:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *                      allocated block may be a bit bigger than the requested
 119:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *                      size for alignment and fragmentation reasons.
 120:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @return              A pointer to the allocated block.
 121:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @retval NULL         if the block cannot be allocated.
 122:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
 123:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @api
 124:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
 125:/usr/src/chibiostest/os/kernel/src/chheap.c **** void *chHeapAlloc(MemoryHeap *heapp, size_t size) {
 157              		.loc 1 125 0
 158              		.cfi_startproc
 159              		@ args = 0, pretend = 0, frame = 24
 160              		@ frame_needed = 0, uses_anonymous_args = 0
 161 0000 00B5     		push	{lr}
 162              		.cfi_def_cfa_offset 4
 163              		.cfi_offset 14, -4
 164 0002 87B0     		sub	sp, sp, #28
 165              		.cfi_def_cfa_offset 32
 166 0004 0190     		str	r0, [sp, #4]
 167 0006 0091     		str	r1, [sp]
 126:/usr/src/chibiostest/os/kernel/src/chheap.c ****   union heap_header *qp, *hp, *fp;
 127:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 128:/usr/src/chibiostest/os/kernel/src/chheap.c ****   if (heapp == NULL)
 168              		.loc 1 128 0
 169 0008 019B     		ldr	r3, [sp, #4]
 170 000a 002B     		cmp	r3, #0
 171 000c 01D1     		bne	.L10
 129:/usr/src/chibiostest/os/kernel/src/chheap.c ****     heapp = &default_heap;
 172              		.loc 1 129 0
 173 000e 344B     		ldr	r3, .L18
 174 0010 0193     		str	r3, [sp, #4]
 175              	.L10:
 130:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 131:/usr/src/chibiostest/os/kernel/src/chheap.c ****   size = MEM_ALIGN_NEXT(size);
 176              		.loc 1 131 0
 177 0012 009B     		ldr	r3, [sp]
 178 0014 0733     		adds	r3, r3, #7
 179 0016 23F00703 		bic	r3, r3, #7
 180 001a 0093     		str	r3, [sp]
 132:/usr/src/chibiostest/os/kernel/src/chheap.c ****   qp = &heapp->h_free;
 181              		.loc 1 132 0
 182 001c 019B     		ldr	r3, [sp, #4]
 183 001e 0833     		adds	r3, r3, #8
 184 0020 0593     		str	r3, [sp, #20]
 133:/usr/src/chibiostest/os/kernel/src/chheap.c ****   H_LOCK(heapp);
 185              		.loc 1 133 0
 186 0022 019B     		ldr	r3, [sp, #4]
 187 0024 1033     		adds	r3, r3, #16
 188 0026 1846     		mov	r0, r3
 189 0028 FFF7FEFF 		bl	chMtxLock
 134:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 135:/usr/src/chibiostest/os/kernel/src/chheap.c ****   while (qp->h.u.next != NULL) {
 190              		.loc 1 135 0
 191 002c 33E0     		b	.L11
 192              	.L16:
 136:/usr/src/chibiostest/os/kernel/src/chheap.c ****     hp = qp->h.u.next;
 193              		.loc 1 136 0
 194 002e 059B     		ldr	r3, [sp, #20]
 195 0030 1B68     		ldr	r3, [r3]
 196 0032 0493     		str	r3, [sp, #16]
 137:/usr/src/chibiostest/os/kernel/src/chheap.c ****     if (hp->h.size >= size) {
 197              		.loc 1 137 0
 198 0034 049B     		ldr	r3, [sp, #16]
 199 0036 5A68     		ldr	r2, [r3, #4]
 200 0038 009B     		ldr	r3, [sp]
 201 003a 9A42     		cmp	r2, r3
 202 003c 29D3     		bcc	.L12
 138:/usr/src/chibiostest/os/kernel/src/chheap.c ****       if (hp->h.size < size + sizeof(union heap_header)) {
 203              		.loc 1 138 0
 204 003e 049B     		ldr	r3, [sp, #16]
 205 0040 5A68     		ldr	r2, [r3, #4]
 206 0042 009B     		ldr	r3, [sp]
 207 0044 0833     		adds	r3, r3, #8
 208 0046 9A42     		cmp	r2, r3
 209 0048 04D2     		bcs	.L13
 139:/usr/src/chibiostest/os/kernel/src/chheap.c ****         /* Gets the whole block even if it is slightly bigger than the
 140:/usr/src/chibiostest/os/kernel/src/chheap.c ****            requested size because the fragment would be too small to be
 141:/usr/src/chibiostest/os/kernel/src/chheap.c ****            useful.*/
 142:/usr/src/chibiostest/os/kernel/src/chheap.c ****         qp->h.u.next = hp->h.u.next;
 210              		.loc 1 142 0
 211 004a 049B     		ldr	r3, [sp, #16]
 212 004c 1A68     		ldr	r2, [r3]
 213 004e 059B     		ldr	r3, [sp, #20]
 214 0050 1A60     		str	r2, [r3]
 215 0052 16E0     		b	.L14
 216              	.L13:
 143:/usr/src/chibiostest/os/kernel/src/chheap.c ****       }
 144:/usr/src/chibiostest/os/kernel/src/chheap.c ****       else {
 145:/usr/src/chibiostest/os/kernel/src/chheap.c ****         /* Block bigger enough, must split it.*/
 146:/usr/src/chibiostest/os/kernel/src/chheap.c ****         fp = (void *)((uint8_t *)(hp) + sizeof(union heap_header) + size);
 217              		.loc 1 146 0
 218 0054 009B     		ldr	r3, [sp]
 219 0056 0833     		adds	r3, r3, #8
 220 0058 049A     		ldr	r2, [sp, #16]
 221 005a 1344     		add	r3, r3, r2
 222 005c 0393     		str	r3, [sp, #12]
 147:/usr/src/chibiostest/os/kernel/src/chheap.c ****         fp->h.u.next = hp->h.u.next;
 223              		.loc 1 147 0
 224 005e 049B     		ldr	r3, [sp, #16]
 225 0060 1A68     		ldr	r2, [r3]
 226 0062 039B     		ldr	r3, [sp, #12]
 227 0064 1A60     		str	r2, [r3]
 148:/usr/src/chibiostest/os/kernel/src/chheap.c ****         fp->h.size = hp->h.size - sizeof(union heap_header) - size;
 228              		.loc 1 148 0
 229 0066 049B     		ldr	r3, [sp, #16]
 230 0068 5A68     		ldr	r2, [r3, #4]
 231 006a 009B     		ldr	r3, [sp]
 232 006c D31A     		subs	r3, r2, r3
 233 006e A3F10802 		sub	r2, r3, #8
 234 0072 039B     		ldr	r3, [sp, #12]
 235 0074 5A60     		str	r2, [r3, #4]
 149:/usr/src/chibiostest/os/kernel/src/chheap.c ****         qp->h.u.next = fp;
 236              		.loc 1 149 0
 237 0076 059B     		ldr	r3, [sp, #20]
 238 0078 039A     		ldr	r2, [sp, #12]
 239 007a 1A60     		str	r2, [r3]
 150:/usr/src/chibiostest/os/kernel/src/chheap.c ****         hp->h.size = size;
 240              		.loc 1 150 0
 241 007c 049B     		ldr	r3, [sp, #16]
 242 007e 009A     		ldr	r2, [sp]
 243 0080 5A60     		str	r2, [r3, #4]
 244              	.L14:
 151:/usr/src/chibiostest/os/kernel/src/chheap.c ****       }
 152:/usr/src/chibiostest/os/kernel/src/chheap.c ****       hp->h.u.heap = heapp;
 245              		.loc 1 152 0
 246 0082 049B     		ldr	r3, [sp, #16]
 247 0084 019A     		ldr	r2, [sp, #4]
 248 0086 1A60     		str	r2, [r3]
 153:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 154:/usr/src/chibiostest/os/kernel/src/chheap.c ****       H_UNLOCK(heapp);
 249              		.loc 1 154 0
 250 0088 FFF7FEFF 		bl	chMtxUnlock
 155:/usr/src/chibiostest/os/kernel/src/chheap.c ****       return (void *)(hp + 1);
 251              		.loc 1 155 0
 252 008c 049B     		ldr	r3, [sp, #16]
 253 008e 0833     		adds	r3, r3, #8
 254 0090 21E0     		b	.L15
 255              	.L12:
 156:/usr/src/chibiostest/os/kernel/src/chheap.c ****     }
 157:/usr/src/chibiostest/os/kernel/src/chheap.c ****     qp = hp;
 256              		.loc 1 157 0
 257 0092 049B     		ldr	r3, [sp, #16]
 258 0094 0593     		str	r3, [sp, #20]
 259              	.L11:
 135:/usr/src/chibiostest/os/kernel/src/chheap.c ****     hp = qp->h.u.next;
 260              		.loc 1 135 0 discriminator 1
 261 0096 059B     		ldr	r3, [sp, #20]
 262 0098 1B68     		ldr	r3, [r3]
 263 009a 002B     		cmp	r3, #0
 264 009c C7D1     		bne	.L16
 158:/usr/src/chibiostest/os/kernel/src/chheap.c ****   }
 159:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 160:/usr/src/chibiostest/os/kernel/src/chheap.c ****   H_UNLOCK(heapp);
 265              		.loc 1 160 0
 266 009e FFF7FEFF 		bl	chMtxUnlock
 161:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 162:/usr/src/chibiostest/os/kernel/src/chheap.c ****   /* More memory is required, tries to get it from the associated provider
 163:/usr/src/chibiostest/os/kernel/src/chheap.c ****      else fails.*/
 164:/usr/src/chibiostest/os/kernel/src/chheap.c ****   if (heapp->h_provider) {
 267              		.loc 1 164 0
 268 00a2 019B     		ldr	r3, [sp, #4]
 269 00a4 1B68     		ldr	r3, [r3]
 270 00a6 002B     		cmp	r3, #0
 271 00a8 14D0     		beq	.L17
 165:/usr/src/chibiostest/os/kernel/src/chheap.c ****     hp = heapp->h_provider(size + sizeof(union heap_header));
 272              		.loc 1 165 0
 273 00aa 019B     		ldr	r3, [sp, #4]
 274 00ac 1B68     		ldr	r3, [r3]
 275 00ae 009A     		ldr	r2, [sp]
 276 00b0 0832     		adds	r2, r2, #8
 277 00b2 1046     		mov	r0, r2
 278 00b4 9847     		blx	r3
 279 00b6 0490     		str	r0, [sp, #16]
 166:/usr/src/chibiostest/os/kernel/src/chheap.c ****     if (hp != NULL) {
 280              		.loc 1 166 0
 281 00b8 049B     		ldr	r3, [sp, #16]
 282 00ba 002B     		cmp	r3, #0
 283 00bc 0AD0     		beq	.L17
 167:/usr/src/chibiostest/os/kernel/src/chheap.c ****       hp->h.u.heap = heapp;
 284              		.loc 1 167 0
 285 00be 049B     		ldr	r3, [sp, #16]
 286 00c0 019A     		ldr	r2, [sp, #4]
 287 00c2 1A60     		str	r2, [r3]
 168:/usr/src/chibiostest/os/kernel/src/chheap.c ****       hp->h.size = size;
 288              		.loc 1 168 0
 289 00c4 049B     		ldr	r3, [sp, #16]
 290 00c6 009A     		ldr	r2, [sp]
 291 00c8 5A60     		str	r2, [r3, #4]
 169:/usr/src/chibiostest/os/kernel/src/chheap.c ****       hp++;
 292              		.loc 1 169 0
 293 00ca 049B     		ldr	r3, [sp, #16]
 294 00cc 0833     		adds	r3, r3, #8
 295 00ce 0493     		str	r3, [sp, #16]
 170:/usr/src/chibiostest/os/kernel/src/chheap.c ****       return (void *)hp;
 296              		.loc 1 170 0
 297 00d0 049B     		ldr	r3, [sp, #16]
 298 00d2 00E0     		b	.L15
 299              	.L17:
 171:/usr/src/chibiostest/os/kernel/src/chheap.c ****     }
 172:/usr/src/chibiostest/os/kernel/src/chheap.c ****   }
 173:/usr/src/chibiostest/os/kernel/src/chheap.c ****   return NULL;
 300              		.loc 1 173 0
 301 00d4 0023     		movs	r3, #0
 302              	.L15:
 174:/usr/src/chibiostest/os/kernel/src/chheap.c **** }
 303              		.loc 1 174 0
 304 00d6 1846     		mov	r0, r3
 305 00d8 07B0     		add	sp, sp, #28
 306              		@ sp needed
 307 00da 5DF804FB 		ldr	pc, [sp], #4
 308              	.L19:
 309 00de 00BF     		.align	2
 310              	.L18:
 311 00e0 00000000 		.word	default_heap
 312              		.cfi_endproc
 313              	.LFE9:
 315 00e4 AFF30080 		.section	.rodata
 315      AFF30080 
 315      AFF30080 
 316 000f 00       		.align	2
 317              	.LC1:
 318 0010 22636848 		.ascii	"\"chHeapFree\"()\000"
 318      65617046 
 318      72656522 
 318      282900
 319 001f 00       		.align	2
 320              	.LC2:
 321 0020 63684865 		.ascii	"chHeapFree(), #1\000"
 321      61704672 
 321      65652829 
 321      2C202331 
 321      00
 322 0031 000000   		.section	.text.chHeapFree,"ax",%progbits
 323              		.align	2
 324              		.p2align 4,,15
 325              		.global	chHeapFree
 326              		.thumb
 327              		.thumb_func
 329              	chHeapFree:
 330              	.LFB10:
 175:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 176:/usr/src/chibiostest/os/kernel/src/chheap.c **** #define LIMIT(p) (union heap_header *)((uint8_t *)(p) + \
 177:/usr/src/chibiostest/os/kernel/src/chheap.c ****                                         sizeof(union heap_header) + \
 178:/usr/src/chibiostest/os/kernel/src/chheap.c ****                                         (p)->h.size)
 179:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 180:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
 181:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Frees a previously allocated memory block.
 182:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
 183:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] p         pointer to the memory block to be freed
 184:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
 185:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @api
 186:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
 187:/usr/src/chibiostest/os/kernel/src/chheap.c **** void chHeapFree(void *p) {
 331              		.loc 1 187 0
 332              		.cfi_startproc
 333              		@ args = 0, pretend = 0, frame = 24
 334              		@ frame_needed = 0, uses_anonymous_args = 0
 335 0000 00B5     		push	{lr}
 336              		.cfi_def_cfa_offset 4
 337              		.cfi_offset 14, -4
 338 0002 87B0     		sub	sp, sp, #28
 339              		.cfi_def_cfa_offset 32
 340 0004 0190     		str	r0, [sp, #4]
 188:/usr/src/chibiostest/os/kernel/src/chheap.c ****   union heap_header *qp, *hp;
 189:/usr/src/chibiostest/os/kernel/src/chheap.c ****   MemoryHeap *heapp;
 190:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 191:/usr/src/chibiostest/os/kernel/src/chheap.c ****   chDbgCheck(p != NULL, "chHeapFree");
 341              		.loc 1 191 0
 342 0006 019B     		ldr	r3, [sp, #4]
 343 0008 002B     		cmp	r3, #0
 344 000a 02D1     		bne	.L21
 345              		.loc 1 191 0 is_stmt 0 discriminator 1
 346 000c 3948     		ldr	r0, .L31
 347 000e FFF7FEFF 		bl	chDbgPanic
 348              	.L21:
 192:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 193:/usr/src/chibiostest/os/kernel/src/chheap.c ****   hp = (union heap_header *)p - 1;
 349              		.loc 1 193 0 is_stmt 1
 350 0012 019B     		ldr	r3, [sp, #4]
 351 0014 083B     		subs	r3, r3, #8
 352 0016 0493     		str	r3, [sp, #16]
 194:/usr/src/chibiostest/os/kernel/src/chheap.c ****   heapp = hp->h.u.heap;
 353              		.loc 1 194 0
 354 0018 049B     		ldr	r3, [sp, #16]
 355 001a 1B68     		ldr	r3, [r3]
 356 001c 0393     		str	r3, [sp, #12]
 195:/usr/src/chibiostest/os/kernel/src/chheap.c ****   qp = &heapp->h_free;
 357              		.loc 1 195 0
 358 001e 039B     		ldr	r3, [sp, #12]
 359 0020 0833     		adds	r3, r3, #8
 360 0022 0593     		str	r3, [sp, #20]
 196:/usr/src/chibiostest/os/kernel/src/chheap.c ****   H_LOCK(heapp);
 361              		.loc 1 196 0
 362 0024 039B     		ldr	r3, [sp, #12]
 363 0026 1033     		adds	r3, r3, #16
 364 0028 1846     		mov	r0, r3
 365 002a FFF7FEFF 		bl	chMtxLock
 366              	.L29:
 197:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 198:/usr/src/chibiostest/os/kernel/src/chheap.c ****   while (TRUE) {
 199:/usr/src/chibiostest/os/kernel/src/chheap.c ****     chDbgAssert((hp < qp) || (hp >= LIMIT(qp)),
 367              		.loc 1 199 0
 368 002e 049A     		ldr	r2, [sp, #16]
 369 0030 059B     		ldr	r3, [sp, #20]
 370 0032 9A42     		cmp	r2, r3
 371 0034 0AD3     		bcc	.L22
 372              		.loc 1 199 0 is_stmt 0 discriminator 1
 373 0036 059B     		ldr	r3, [sp, #20]
 374 0038 5B68     		ldr	r3, [r3, #4]
 375 003a 0833     		adds	r3, r3, #8
 376 003c 059A     		ldr	r2, [sp, #20]
 377 003e 1A44     		add	r2, r2, r3
 378 0040 049B     		ldr	r3, [sp, #16]
 379 0042 9A42     		cmp	r2, r3
 380 0044 02D9     		bls	.L22
 381 0046 2C48     		ldr	r0, .L31+4
 382 0048 FFF7FEFF 		bl	chDbgPanic
 383              	.L22:
 200:/usr/src/chibiostest/os/kernel/src/chheap.c ****                 "chHeapFree(), #1",
 201:/usr/src/chibiostest/os/kernel/src/chheap.c ****                 "within free block");
 202:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 203:/usr/src/chibiostest/os/kernel/src/chheap.c ****     if (((qp == &heapp->h_free) || (hp > qp)) &&
 384              		.loc 1 203 0 is_stmt 1
 385 004c 039B     		ldr	r3, [sp, #12]
 386 004e 03F10802 		add	r2, r3, #8
 387 0052 059B     		ldr	r3, [sp, #20]
 388 0054 9A42     		cmp	r2, r3
 389 0056 03D0     		beq	.L23
 390              		.loc 1 203 0 is_stmt 0 discriminator 2
 391 0058 049A     		ldr	r2, [sp, #16]
 392 005a 059B     		ldr	r3, [sp, #20]
 393 005c 9A42     		cmp	r2, r3
 394 005e 3ED9     		bls	.L24
 395              	.L23:
 204:/usr/src/chibiostest/os/kernel/src/chheap.c ****         ((qp->h.u.next == NULL) || (hp < qp->h.u.next))) {
 396              		.loc 1 204 0 is_stmt 1 discriminator 1
 397 0060 059B     		ldr	r3, [sp, #20]
 398 0062 1B68     		ldr	r3, [r3]
 203:/usr/src/chibiostest/os/kernel/src/chheap.c ****         ((qp->h.u.next == NULL) || (hp < qp->h.u.next))) {
 399              		.loc 1 203 0 discriminator 1
 400 0064 002B     		cmp	r3, #0
 401 0066 04D0     		beq	.L25
 402              		.loc 1 204 0
 403 0068 059B     		ldr	r3, [sp, #20]
 404 006a 1A68     		ldr	r2, [r3]
 405 006c 049B     		ldr	r3, [sp, #16]
 406 006e 9A42     		cmp	r2, r3
 407 0070 35D9     		bls	.L24
 408              	.L25:
 205:/usr/src/chibiostest/os/kernel/src/chheap.c ****       /* Insertion after qp.*/
 206:/usr/src/chibiostest/os/kernel/src/chheap.c ****       hp->h.u.next = qp->h.u.next;
 409              		.loc 1 206 0
 410 0072 059B     		ldr	r3, [sp, #20]
 411 0074 1A68     		ldr	r2, [r3]
 412 0076 049B     		ldr	r3, [sp, #16]
 413 0078 1A60     		str	r2, [r3]
 207:/usr/src/chibiostest/os/kernel/src/chheap.c ****       qp->h.u.next = hp;
 414              		.loc 1 207 0
 415 007a 059B     		ldr	r3, [sp, #20]
 416 007c 049A     		ldr	r2, [sp, #16]
 417 007e 1A60     		str	r2, [r3]
 208:/usr/src/chibiostest/os/kernel/src/chheap.c ****       /* Verifies if the newly inserted block should be merged.*/
 209:/usr/src/chibiostest/os/kernel/src/chheap.c ****       if (LIMIT(hp) == hp->h.u.next) {
 418              		.loc 1 209 0
 419 0080 049B     		ldr	r3, [sp, #16]
 420 0082 5B68     		ldr	r3, [r3, #4]
 421 0084 0833     		adds	r3, r3, #8
 422 0086 049A     		ldr	r2, [sp, #16]
 423 0088 1A44     		add	r2, r2, r3
 424 008a 049B     		ldr	r3, [sp, #16]
 425 008c 1B68     		ldr	r3, [r3]
 426 008e 9A42     		cmp	r2, r3
 427 0090 0ED1     		bne	.L26
 210:/usr/src/chibiostest/os/kernel/src/chheap.c ****         /* Merge with the next block.*/
 211:/usr/src/chibiostest/os/kernel/src/chheap.c ****         hp->h.size += hp->h.u.next->h.size + sizeof(union heap_header);
 428              		.loc 1 211 0
 429 0092 049B     		ldr	r3, [sp, #16]
 430 0094 5A68     		ldr	r2, [r3, #4]
 431 0096 049B     		ldr	r3, [sp, #16]
 432 0098 1B68     		ldr	r3, [r3]
 433 009a 5B68     		ldr	r3, [r3, #4]
 434 009c 1344     		add	r3, r3, r2
 435 009e 03F10802 		add	r2, r3, #8
 436 00a2 049B     		ldr	r3, [sp, #16]
 437 00a4 5A60     		str	r2, [r3, #4]
 212:/usr/src/chibiostest/os/kernel/src/chheap.c ****         hp->h.u.next = hp->h.u.next->h.u.next;
 438              		.loc 1 212 0
 439 00a6 049B     		ldr	r3, [sp, #16]
 440 00a8 1B68     		ldr	r3, [r3]
 441 00aa 1A68     		ldr	r2, [r3]
 442 00ac 049B     		ldr	r3, [sp, #16]
 443 00ae 1A60     		str	r2, [r3]
 444              	.L26:
 213:/usr/src/chibiostest/os/kernel/src/chheap.c ****       }
 214:/usr/src/chibiostest/os/kernel/src/chheap.c ****       if ((LIMIT(qp) == hp)) {
 445              		.loc 1 214 0
 446 00b0 059B     		ldr	r3, [sp, #20]
 447 00b2 5B68     		ldr	r3, [r3, #4]
 448 00b4 0833     		adds	r3, r3, #8
 449 00b6 059A     		ldr	r2, [sp, #20]
 450 00b8 1A44     		add	r2, r2, r3
 451 00ba 049B     		ldr	r3, [sp, #16]
 452 00bc 9A42     		cmp	r2, r3
 453 00be 0DD1     		bne	.L27
 215:/usr/src/chibiostest/os/kernel/src/chheap.c ****         /* Merge with the previous block.*/
 216:/usr/src/chibiostest/os/kernel/src/chheap.c ****         qp->h.size += hp->h.size + sizeof(union heap_header);
 454              		.loc 1 216 0
 455 00c0 059B     		ldr	r3, [sp, #20]
 456 00c2 5A68     		ldr	r2, [r3, #4]
 457 00c4 049B     		ldr	r3, [sp, #16]
 458 00c6 5B68     		ldr	r3, [r3, #4]
 459 00c8 1344     		add	r3, r3, r2
 460 00ca 03F10802 		add	r2, r3, #8
 461 00ce 059B     		ldr	r3, [sp, #20]
 462 00d0 5A60     		str	r2, [r3, #4]
 217:/usr/src/chibiostest/os/kernel/src/chheap.c ****         qp->h.u.next = hp->h.u.next;
 463              		.loc 1 217 0
 464 00d2 049B     		ldr	r3, [sp, #16]
 465 00d4 1A68     		ldr	r2, [r3]
 466 00d6 059B     		ldr	r3, [sp, #20]
 467 00d8 1A60     		str	r2, [r3]
 218:/usr/src/chibiostest/os/kernel/src/chheap.c ****       }
 219:/usr/src/chibiostest/os/kernel/src/chheap.c ****       break;
 468              		.loc 1 219 0
 469 00da 04E0     		b	.L28
 470              	.L27:
 471 00dc 03E0     		b	.L28
 472              	.L24:
 220:/usr/src/chibiostest/os/kernel/src/chheap.c ****     }
 221:/usr/src/chibiostest/os/kernel/src/chheap.c ****     qp = qp->h.u.next;
 473              		.loc 1 221 0
 474 00de 059B     		ldr	r3, [sp, #20]
 475 00e0 1B68     		ldr	r3, [r3]
 476 00e2 0593     		str	r3, [sp, #20]
 222:/usr/src/chibiostest/os/kernel/src/chheap.c ****   }
 477              		.loc 1 222 0
 478 00e4 A3E7     		b	.L29
 479              	.L28:
 223:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 224:/usr/src/chibiostest/os/kernel/src/chheap.c ****   H_UNLOCK(heapp);
 480              		.loc 1 224 0
 481 00e6 FFF7FEFF 		bl	chMtxUnlock
 225:/usr/src/chibiostest/os/kernel/src/chheap.c ****   return;
 482              		.loc 1 225 0
 483 00ea 00BF     		nop
 226:/usr/src/chibiostest/os/kernel/src/chheap.c **** }
 484              		.loc 1 226 0
 485 00ec 07B0     		add	sp, sp, #28
 486              		@ sp needed
 487 00ee 5DF804FB 		ldr	pc, [sp], #4
 488              	.L32:
 489 00f2 00BF     		.align	2
 490              	.L31:
 491 00f4 10000000 		.word	.LC1
 492 00f8 20000000 		.word	.LC2
 493              		.cfi_endproc
 494              	.LFE10:
 496 00fc AFF30080 		.section	.text.chHeapStatus,"ax",%progbits
 497              		.align	2
 498              		.p2align 4,,15
 499              		.global	chHeapStatus
 500              		.thumb
 501              		.thumb_func
 503              	chHeapStatus:
 504              	.LFB11:
 227:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 228:/usr/src/chibiostest/os/kernel/src/chheap.c **** /**
 229:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @brief   Reports the heap status.
 230:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @note    This function is meant to be used in the test suite, it should
 231:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          not be really useful for the application code.
 232:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @note    This function is not implemented when the @p CH_USE_MALLOC_HEAP
 233:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *          configuration option is used (it always returns zero).
 234:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
 235:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] heapp     pointer to a heap descriptor or @p NULL in order to
 236:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *                      access the default heap.
 237:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @param[in] sizep     pointer to a variable that will receive the total
 238:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *                      fragmented free space
 239:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @return              The number of fragments in the heap.
 240:/usr/src/chibiostest/os/kernel/src/chheap.c ****  *
 241:/usr/src/chibiostest/os/kernel/src/chheap.c ****  * @api
 242:/usr/src/chibiostest/os/kernel/src/chheap.c ****  */
 243:/usr/src/chibiostest/os/kernel/src/chheap.c **** size_t chHeapStatus(MemoryHeap *heapp, size_t *sizep) {
 505              		.loc 1 243 0
 506              		.cfi_startproc
 507              		@ args = 0, pretend = 0, frame = 24
 508              		@ frame_needed = 0, uses_anonymous_args = 0
 509 0000 00B5     		push	{lr}
 510              		.cfi_def_cfa_offset 4
 511              		.cfi_offset 14, -4
 512 0002 87B0     		sub	sp, sp, #28
 513              		.cfi_def_cfa_offset 32
 514 0004 0190     		str	r0, [sp, #4]
 515 0006 0091     		str	r1, [sp]
 244:/usr/src/chibiostest/os/kernel/src/chheap.c ****   union heap_header *qp;
 245:/usr/src/chibiostest/os/kernel/src/chheap.c ****   size_t n, sz;
 246:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 247:/usr/src/chibiostest/os/kernel/src/chheap.c ****   if (heapp == NULL)
 516              		.loc 1 247 0
 517 0008 019B     		ldr	r3, [sp, #4]
 518 000a 002B     		cmp	r3, #0
 519 000c 01D1     		bne	.L34
 248:/usr/src/chibiostest/os/kernel/src/chheap.c ****     heapp = &default_heap;
 520              		.loc 1 248 0
 521 000e 164B     		ldr	r3, .L39
 522 0010 0193     		str	r3, [sp, #4]
 523              	.L34:
 249:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 250:/usr/src/chibiostest/os/kernel/src/chheap.c ****   H_LOCK(heapp);
 524              		.loc 1 250 0
 525 0012 019B     		ldr	r3, [sp, #4]
 526 0014 1033     		adds	r3, r3, #16
 527 0016 1846     		mov	r0, r3
 528 0018 FFF7FEFF 		bl	chMtxLock
 251:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 252:/usr/src/chibiostest/os/kernel/src/chheap.c ****   sz = 0;
 529              		.loc 1 252 0
 530 001c 0023     		movs	r3, #0
 531 001e 0393     		str	r3, [sp, #12]
 253:/usr/src/chibiostest/os/kernel/src/chheap.c ****   for (n = 0, qp = &heapp->h_free; qp->h.u.next; n++, qp = qp->h.u.next)
 532              		.loc 1 253 0
 533 0020 0023     		movs	r3, #0
 534 0022 0493     		str	r3, [sp, #16]
 535 0024 019B     		ldr	r3, [sp, #4]
 536 0026 0833     		adds	r3, r3, #8
 537 0028 0593     		str	r3, [sp, #20]
 538 002a 0BE0     		b	.L35
 539              	.L36:
 254:/usr/src/chibiostest/os/kernel/src/chheap.c ****     sz += qp->h.u.next->h.size;
 540              		.loc 1 254 0 discriminator 2
 541 002c 059B     		ldr	r3, [sp, #20]
 542 002e 1B68     		ldr	r3, [r3]
 543 0030 5B68     		ldr	r3, [r3, #4]
 544 0032 039A     		ldr	r2, [sp, #12]
 545 0034 1344     		add	r3, r3, r2
 546 0036 0393     		str	r3, [sp, #12]
 253:/usr/src/chibiostest/os/kernel/src/chheap.c ****   for (n = 0, qp = &heapp->h_free; qp->h.u.next; n++, qp = qp->h.u.next)
 547              		.loc 1 253 0 discriminator 2
 548 0038 049B     		ldr	r3, [sp, #16]
 549 003a 0133     		adds	r3, r3, #1
 550 003c 0493     		str	r3, [sp, #16]
 551 003e 059B     		ldr	r3, [sp, #20]
 552 0040 1B68     		ldr	r3, [r3]
 553 0042 0593     		str	r3, [sp, #20]
 554              	.L35:
 253:/usr/src/chibiostest/os/kernel/src/chheap.c ****   for (n = 0, qp = &heapp->h_free; qp->h.u.next; n++, qp = qp->h.u.next)
 555              		.loc 1 253 0 is_stmt 0 discriminator 1
 556 0044 059B     		ldr	r3, [sp, #20]
 557 0046 1B68     		ldr	r3, [r3]
 558 0048 002B     		cmp	r3, #0
 559 004a EFD1     		bne	.L36
 255:/usr/src/chibiostest/os/kernel/src/chheap.c ****   if (sizep)
 560              		.loc 1 255 0 is_stmt 1
 561 004c 009B     		ldr	r3, [sp]
 562 004e 002B     		cmp	r3, #0
 563 0050 02D0     		beq	.L37
 256:/usr/src/chibiostest/os/kernel/src/chheap.c ****     *sizep = sz;
 564              		.loc 1 256 0
 565 0052 009B     		ldr	r3, [sp]
 566 0054 039A     		ldr	r2, [sp, #12]
 567 0056 1A60     		str	r2, [r3]
 568              	.L37:
 257:/usr/src/chibiostest/os/kernel/src/chheap.c **** 
 258:/usr/src/chibiostest/os/kernel/src/chheap.c ****   H_UNLOCK(heapp);
 569              		.loc 1 258 0
 570 0058 FFF7FEFF 		bl	chMtxUnlock
 259:/usr/src/chibiostest/os/kernel/src/chheap.c ****   return n;
 571              		.loc 1 259 0
 572 005c 049B     		ldr	r3, [sp, #16]
 260:/usr/src/chibiostest/os/kernel/src/chheap.c **** }
 573              		.loc 1 260 0
 574 005e 1846     		mov	r0, r3
 575 0060 07B0     		add	sp, sp, #28
 576              		@ sp needed
 577 0062 5DF804FB 		ldr	pc, [sp], #4
 578              	.L40:
 579 0066 00BF     		.align	2
 580              	.L39:
 581 0068 00000000 		.word	default_heap
 582              		.cfi_endproc
 583              	.LFE11:
 585 006c AFF30080 		.text
 586              	.Letext0:
 587              		.file 2 "/usr/lib/gcc/arm-none-eabi/4.8/include/stddef.h"
 588              		.file 3 "/usr/include/newlib/machine/_default_types.h"
 589              		.file 4 "/usr/include/newlib/stdint.h"
 590              		.file 5 "/usr/src/chibiostest/os/ports/GCC/ARMCMx/chtypes.h"
 591              		.file 6 "/usr/src/chibiostest/os/kernel/include/chlists.h"
 592              		.file 7 "/usr/src/chibiostest/os/kernel/include/chthreads.h"
 593              		.file 8 "/usr/src/chibiostest/os/ports/GCC/ARMCMx/chcore_v7m.h"
 594              		.file 9 "/usr/src/chibiostest/os/kernel/include/chmtx.h"
 595              		.file 10 "/usr/src/chibiostest/os/kernel/include/chmemcore.h"
 596              		.file 11 "/usr/src/chibiostest/os/kernel/include/chheap.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 chheap.c
     /tmp/ccoI8RzC.s:20     .bss.default_heap:0000000000000000 $d
     /tmp/ccoI8RzC.s:23     .bss.default_heap:0000000000000000 default_heap
     /tmp/ccoI8RzC.s:26     .text._heap_init:0000000000000000 $t
     /tmp/ccoI8RzC.s:32     .text._heap_init:0000000000000000 _heap_init
     /tmp/ccoI8RzC.s:63     .text._heap_init:000000000000001c $d
     /tmp/ccoI8RzC.s:70     .rodata:0000000000000000 $d
     /tmp/ccoI8RzC.s:74     .text.chHeapInit:0000000000000000 $t
     /tmp/ccoI8RzC.s:80     .text.chHeapInit:0000000000000000 chHeapInit
     /tmp/ccoI8RzC.s:144    .text.chHeapInit:000000000000005c $d
     /tmp/ccoI8RzC.s:149    .text.chHeapAlloc:0000000000000000 $t
     /tmp/ccoI8RzC.s:155    .text.chHeapAlloc:0000000000000000 chHeapAlloc
     /tmp/ccoI8RzC.s:311    .text.chHeapAlloc:00000000000000e0 $d
     /tmp/ccoI8RzC.s:323    .text.chHeapFree:0000000000000000 $t
     /tmp/ccoI8RzC.s:329    .text.chHeapFree:0000000000000000 chHeapFree
     /tmp/ccoI8RzC.s:491    .text.chHeapFree:00000000000000f4 $d
     /tmp/ccoI8RzC.s:497    .text.chHeapStatus:0000000000000000 $t
     /tmp/ccoI8RzC.s:503    .text.chHeapStatus:0000000000000000 chHeapStatus
     /tmp/ccoI8RzC.s:581    .text.chHeapStatus:0000000000000068 $d
                     .debug_frame:0000000000000010 $d
     /tmp/ccoI8RzC.s:69     .text._heap_init:0000000000000028 $t
     /tmp/ccoI8RzC.s:315    .text.chHeapAlloc:00000000000000e4 $t
     /tmp/ccoI8RzC.s:496    .text.chHeapFree:00000000000000fc $t
     /tmp/ccoI8RzC.s:585    .text.chHeapStatus:000000000000006c $t

UNDEFINED SYMBOLS
chMtxInit
chCoreAlloc
chDbgPanic
chMtxLock
chMtxUnlock
